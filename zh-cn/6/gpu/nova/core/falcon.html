<!DOCTYPE html>

<html lang="zh-CN" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Falcon (FAst Logic Controller) &#8212; The Linux Kernel unknown version 文档</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../../_static/documentation_options.js?v=c459948e"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/translations.js?v=beaddf03"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/gpu/nova/core/falcon.html" />
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="Backlight support" href="../../backlight.html" />
    <link rel="prev" title="FWSEC (Firmware Security)" href="fwsec.html" />

   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="提交" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../subsystem-apis.html#human-interfaces">Human interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../input/index.html">Input Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sound/index.html">Sound Subsystem Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">GPU Driver Developer's Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#other-subsystems">Other subsystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/gpu/nova/core/falcon.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="falcon-fast-logic-controller">
<h1>Falcon (FAst Logic Controller)<a class="headerlink" href="#falcon-fast-logic-controller" title="Link to this heading">¶</a></h1>
<p>The following sections describe the Falcon core and the ucode running on it.
The descriptions are based on the Ampere GPU or earlier designs; however, they
should mostly apply to future designs as well, but everything is subject to
change. The overview provided here is mainly tailored towards understanding the
interactions of nova-core driver with the Falcon.</p>
<p>NVIDIA GPUs embed small RISC-like microcontrollers called Falcon cores, which
handle secure firmware tasks, initialization, and power management. Modern
NVIDIA GPUs may have multiple such Falcon instances (e.g., GSP (the GPU system
processor) and SEC2 (the security engine)) and also may integrate a RISC-V core.
This core is capable of running both RISC-V and Falcon code.</p>
<p>The code running on the Falcon cores is also called 'ucode', and will be
referred to as such in the following sections.</p>
<p>Falcons have separate instruction and data memories (IMEM/DMEM) and provide a
small DMA engine (via the FBIF - &quot;Frame Buffer Interface&quot;) to load code from
system memory. The nova-core driver must reset and configure the Falcon, load
its firmware via DMA, and start its CPU.</p>
<section id="falcon-security-levels">
<h2>Falcon security levels<a class="headerlink" href="#falcon-security-levels" title="Link to this heading">¶</a></h2>
<p>Falcons can run in Non-secure (NS), Light Secure (LS), or Heavy Secure (HS)
modes.</p>
<section id="heavy-secured-hs-also-known-as-privilege-level-3-pl3">
<h3>Heavy Secured (HS) also known as Privilege Level 3 (PL3)<a class="headerlink" href="#heavy-secured-hs-also-known-as-privilege-level-3-pl3" title="Link to this heading">¶</a></h3>
<p>HS ucode is the most trusted code and has access to pretty much everything on
the chip. The HS binary includes a signature in it which is verified at boot.
This signature verification is done by the hardware itself, thus establishing a
root of trust. For example, the FWSEC-FRTS command (see <a class="reference internal" href="fwsec.html"><span class="doc">FWSEC (Firmware Security)</span></a>) runs on the
GSP in HS mode. FRTS, which involves setting up and loading content into the WPR
(Write Protect Region), has to be done by the HS ucode and cannot be done by the
host CPU or LS ucode.</p>
</section>
<section id="light-secured-ls-or-pl2-and-non-secured-ns-or-pl0">
<h3>Light Secured (LS or PL2) and Non Secured (NS or PL0)<a class="headerlink" href="#light-secured-ls-or-pl2-and-non-secured-ns-or-pl0" title="Link to this heading">¶</a></h3>
<p>These modes are less secure than HS. Like HS, the LS or NS ucode binary also
typically includes a signature in it. To load firmware in LS or NS mode onto a
Falcon, another Falcon needs to be running in HS mode, which also establishes the
root of trust. For example, in the case of an Ampere GPU, the CPU runs the &quot;Booter&quot;
ucode in HS mode on the SEC2 Falcon, which then authenticates and runs the
run-time GSP binary (GSP-RM) in LS mode on the GSP Falcon. Similarly, as an
example, after reset on an Ampere, FWSEC runs on the GSP which then loads the
devinit engine onto the PMU in LS mode.</p>
</section>
<section id="root-of-trust-establishment">
<h3>Root of trust establishment<a class="headerlink" href="#root-of-trust-establishment" title="Link to this heading">¶</a></h3>
<p>To establish a root of trust, the code running on a Falcon must be immutable and
hardwired into a read-only memory (ROM). This follows industry norms for
verification of firmware. This code is called the Boot ROM (BROM). The nova-core
driver on the CPU communicates with Falcon's Boot ROM through various Falcon
registers prefixed with &quot;BROM&quot; (see regs.rs).</p>
<p>After nova-core driver reads the necessary ucode from VBIOS, it programs the
BROM and DMA registers to trigger the Falcon to load the HS ucode from the system
memory into the Falcon's IMEM/DMEM. Once the HS ucode is loaded, it is verified
by the Falcon's Boot ROM.</p>
<p>Once the verified HS code is running on a Falcon, it can verify and load other
LS/NS ucode binaries onto other Falcons and start them. The process of signature
verification is the same as HS; just in this case, the hardware (BROM) doesn't
compute the signature, but the HS ucode does.</p>
<dl class="simple">
<dt>The root of trust is therefore established as follows:</dt><dd><p>Hardware (Boot ROM running on the Falcon) -&gt; HS ucode -&gt; LS/NS ucode.</p>
</dd>
<dt>On an Ampere GPU, for example, the boot verification flow is:</dt><dd><dl class="simple">
<dt>Hardware (Boot ROM running on the SEC2) -&gt;</dt><dd><dl class="simple">
<dt>HS ucode (Booter running on the SEC2) -&gt;</dt><dd><p>LS ucode (GSP-RM running on the GSP)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>While the CPU can load HS ucode onto a Falcon microcontroller and have it
verified by the hardware and run, the CPU itself typically does not load
LS or NS ucode and run it. Loading of LS or NS ucode is done mainly by the
HS ucode. For example, on an Ampere GPU, after the Booter ucode runs on the
SEC2 in HS mode and loads the GSP-RM binary onto the GSP, it needs to run
the &quot;SEC2-RTOS&quot; ucode at runtime. This presents a problem: there is no
component to load the SEC2-RTOS ucode onto the SEC2. The CPU cannot load
LS code, and GSP-RM must run in LS mode. To overcome this, the GSP is
temporarily made to run HS ucode (which is itself loaded by the CPU via
the nova-core driver using a &quot;GSP-provided sequencer&quot;) which then loads
the SEC2-RTOS ucode onto the SEC2 in LS mode. The GSP then resumes
running its own GSP-RM LS ucode.</p>
</div>
</section>
</section>
<section id="falcon-memory-subsystem-and-dma-engine">
<h2>Falcon memory subsystem and DMA engine<a class="headerlink" href="#falcon-memory-subsystem-and-dma-engine" title="Link to this heading">¶</a></h2>
<p>Falcons have separate instruction and data memories (IMEM/DMEM)
and contains a small DMA engine called FBDMA (Framebuffer DMA) which does
DMA transfers to/from the IMEM/DMEM memory inside the Falcon via the FBIF
(Framebuffer Interface), to external memory.</p>
<p>DMA transfers are possible from the Falcon's memory to both the system memory
and the framebuffer memory (VRAM).</p>
<p>To perform a DMA via the FBDMA, the FBIF is configured to decide how the memory
is accessed (also known as aperture type). In the nova-core driver, this is
determined by the <cite>FalconFbifTarget</cite> enum.</p>
<p>The IO-PMP block (Input/Output Physical Memory Protection) unit in the Falcon
controls access by the FBDMA to the external memory.</p>
<p>Conceptual diagram (not exact) of the Falcon and its memory subsystem is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>          External Memory (Framebuffer / System DRAM)
                         ^  |
                         |  |
                         |  v
+-----------------------------------------------------+
|                           |                         |
|   +---------------+       |                         |
|   |     FBIF      |-------+                         |  FALCON
|   | (FrameBuffer  |   Memory Interface              |  PROCESSOR
|   |  InterFace)   |                                 |
|   |  Apertures    |                                 |
|   |  Configures   |                                 |
|   |  mem access   |                                 |
|   +-------^-------+                                 |
|           |                                         |
|           | FBDMA uses configured FBIF apertures    |
|           | to access External Memory
|           |
|   +-------v--------+      +---------------+
|   |    FBDMA       |  cfg |     RISC      |
|   | (FrameBuffer   |&lt;----&gt;|     CORE      |-----&gt;. Direct Core Access
|   |  DMA Engine)   |      |               |      |
|   | - Master dev.  |      | (can run both |      |
|   +-------^--------+      | Falcon and    |      |
|           |        cfg---&gt;| RISC-V code)  |      |
|           |        /      |               |      |
|           |        |      +---------------+      |    +------------+
|           |        |                             |    |   BROM     |
|           |        |                             &lt;---&gt;| (Boot ROM) |
|           |       /                              |    +------------+
|           |      v                               |
|   +---------------+                              |
|   |    IO-PMP     | Controls access by FBDMA     |
|   | (IO Physical  | and other IO Masters         |
|   | Memory Protect)                              |
|   +-------^-------+                              |
|           |                                      |
|           | Protected Access Path for FBDMA      |
|           v                                      |
|   +---------------------------------------+      |
|   |       Memory                          |      |
|   |   +---------------+  +------------+   |      |
|   |   |    IMEM       |  |    DMEM    |   |&lt;-----+
|   |   | (Instruction  |  |   (Data    |   |
|   |   |  Memory)      |  |   Memory)  |   |
|   |   +---------------+  +------------+   |
|   +---------------------------------------+
+-----------------------------------------------------+
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/gpu/nova/core/falcon.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
# SOME DESCRIPTIVE TITLE.
# Copyright (C) The kernel development community
# This file is distributed under the same license as the The Linux Kernel package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: The Linux Kernel master\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-09-29 08:26+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: ../../../networking/nexthop-group-resilient.rst:5
msgid "Resilient Next-hop Groups"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:7
msgid ""
"Resilient groups are a type of next-hop group that is aimed at minimizing "
"disruption in flow routing across changes to the group composition and "
"weights of constituent next hops."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:11
msgid ""
"The idea behind resilient hashing groups is best explained in contrast to "
"the legacy multipath next-hop group, which uses the hash-threshold "
"algorithm, described in RFC 2992."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:15
msgid ""
"To select a next hop, hash-threshold algorithm first assigns a range of "
"hashes to each next hop in the group, and then selects the next hop by "
"comparing the SKB hash with the individual ranges. When a next hop is "
"removed from the group, the ranges are recomputed, which leads to "
"reassignment of parts of hash space from one next hop to another. RFC 2992 "
"illustrates it thus::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:31
msgid ""
"Note how next hop 2 gave up part of the hash space in favor of next hop 1, "
"and 4 in favor of 5. While there will usually be some overlap between the "
"previous and the new distribution, some traffic flows change the next hop "
"that they resolve to."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:36
msgid ""
"If a multipath group is used for load-balancing between multiple servers, "
"this hash space reassignment causes an issue that packets from a single flow "
"suddenly end up arriving at a server that does not expect them. This can "
"result in TCP connections being reset."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:41
msgid ""
"If a multipath group is used for load-balancing among available paths to the "
"same server, the issue is that different latencies and reordering along the "
"way causes the packets to arrive in the wrong order, resulting in degraded "
"application performance."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:46
msgid ""
"To mitigate the above-mentioned flow redirection, resilient next-hop groups "
"insert another layer of indirection between the hash space and its "
"constituent next hops: a hash table. The selection algorithm uses SKB hash "
"to choose a hash table bucket, then reads the next hop that this bucket "
"contains, and forwards traffic there."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:52
msgid ""
"This indirection brings an important feature. In the hash-threshold "
"algorithm, the range of hashes associated with a next hop must be "
"continuous. With a hash table, mapping between the hash table buckets and "
"the individual next hops is arbitrary. Therefore when a next hop is deleted "
"the buckets that held it are simply reassigned to other next hops::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:69
msgid ""
"When weights of next hops in a group are altered, it may be possible to "
"choose a subset of buckets that are currently not used for forwarding "
"traffic, and use those to satisfy the new next-hop distribution demands, "
"keeping the \"busy\" buckets intact. This way, established flows are ideally "
"kept being forwarded to the same endpoints through the same paths as before "
"the next-hop group change."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:77
msgid "Algorithm"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:79
msgid ""
"In a nutshell, the algorithm works as follows. Each next hop deserves a "
"certain number of buckets, according to its weight and the number of buckets "
"in the hash table. In accordance with the source code, we will call this "
"number a \"wants count\" of a next hop. In case of an event that might cause "
"bucket allocation change, the wants counts for individual next hops are "
"updated."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:86
msgid ""
"Next hops that have fewer buckets than their wants count, are called "
"\"underweight\". Those that have more are \"overweight\". If there are no "
"overweight (and therefore no underweight) next hops in the group, it is said "
"to be \"balanced\"."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:91
msgid ""
"Each bucket maintains a last-used timer. Every time a packet is forwarded "
"through a bucket, this timer is updated to current jiffies value. One "
"attribute of a resilient group is then the \"idle timer\", which is the "
"amount of time that a bucket must not be hit by traffic in order for it to "
"be considered \"idle\". Buckets that are not idle are busy."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:97
msgid ""
"After assigning wants counts to next hops, an \"upkeep\" algorithm runs. For "
"buckets:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:100
msgid "that have no assigned next hop, or"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:101
msgid "whose next hop has been removed, or"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:102
msgid "that are idle and their next hop is overweight,"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:104
msgid ""
"upkeep changes the next hop that the bucket references to one of the "
"underweight next hops. If, after considering all buckets in this manner, "
"there are still underweight next hops, another upkeep run is scheduled to a "
"future time."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:109
msgid ""
"There may not be enough \"idle\" buckets to satisfy the updated wants counts "
"of all next hops. Another attribute of a resilient group is the \"unbalanced "
"timer\". This timer can be set to 0, in which case the table will stay out "
"of balance until idle buckets do appear, possibly never. If set to a non-"
"zero value, the value represents the period of time that the table is "
"permitted to stay out of balance."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:116
msgid ""
"With this in mind, we update the above list of conditions with one more "
"item. Thus buckets:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:119
msgid ""
"whose next hop is overweight, and the amount of time that the table has been "
"out of balance exceeds the unbalanced timer, if that is non-zero,"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:122
msgid "\\... are migrated as well."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:125
msgid "Offloading & Driver Feedback"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:127
msgid ""
"When offloading resilient groups, the algorithm that distributes buckets "
"among next hops is still the one in SW. Drivers are notified of updates to "
"next hop groups in the following three ways:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:131
msgid ""
"Full group notification with the type ``NH_NOTIFIER_INFO_TYPE_RES_TABLE``. "
"This is used just after the group is created and buckets populated for the "
"first time."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:135
msgid ""
"Single-bucket notifications of the type "
"``NH_NOTIFIER_INFO_TYPE_RES_BUCKET``, which is used for notifications of "
"individual migrations within an already-established group."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:139
msgid ""
"Pre-replace notification, ``NEXTHOP_EVENT_RES_TABLE_PRE_REPLACE``. This is "
"sent before the group is replaced, and is a way for the driver to veto the "
"group before committing anything to the HW."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:143
msgid ""
"Some single-bucket notifications are forced, as indicated by the \"force\" "
"flag in the notification. Those are used for the cases where e.g. the next "
"hop associated with the bucket was removed, and the bucket really must be "
"migrated."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:148
msgid ""
"Non-forced notifications can be overridden by the driver by returning an "
"error code. The use case for this is that the driver notifies the HW that a "
"bucket should be migrated, but the HW discovers that the bucket has in fact "
"been hit by traffic."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:153
msgid ""
"A second way for the HW to report that a bucket is busy is through the "
"``nexthop_res_grp_activity_update()`` API. The buckets identified this way "
"as busy are treated as if traffic hit them."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:157
msgid ""
"Offloaded buckets should be flagged as either \"offload\" or \"trap\". This "
"is done through the ``nexthop_bucket_set_hw_flags()`` API."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:161
msgid "Netlink UAPI"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:164
msgid "Resilient Group Replacement"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:166
msgid ""
"Resilient groups are configured using the ``RTM_NEWNEXTHOP`` message in the "
"same manner as other multipath groups. The following changes apply to the "
"attributes passed in the netlink message:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:171
msgid "``NHA_GROUP_TYPE``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:171
msgid "Should be ``NEXTHOP_GRP_TYPE_RES`` for resilient group."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:172
msgid "``NHA_RES_GROUP``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:172
msgid "A nest that contains attributes specific to resilient groups."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:176
msgid "``NHA_RES_GROUP`` payload:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:179
msgid "``NHA_RES_GROUP_BUCKETS``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:179
msgid "Number of buckets in the hash table."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:180
msgid "``NHA_RES_GROUP_IDLE_TIMER``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:180
msgid "Idle timer in units of clock_t."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:181
msgid "``NHA_RES_GROUP_UNBALANCED_TIMER``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:181
msgid "Unbalanced timer in units of clock_t."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:185
msgid "Next Hop Get"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:187
msgid ""
"Requests to get resilient next-hop groups use the ``RTM_GETNEXTHOP`` message "
"in exactly the same way as other next hop get requests. The response "
"attributes match the replacement attributes cited above, except "
"``NHA_RES_GROUP`` payload will include the following attribute:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:193
msgid "``NHA_RES_GROUP_UNBALANCED_TIME``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:193
msgid ""
"How long has the resilient group been out of balance, in units of clock_t."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:198
msgid "Bucket Get"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:200
msgid ""
"The message ``RTM_GETNEXTHOPBUCKET`` without the ``NLM_F_DUMP`` flag is used "
"to request a single bucket. The attributes recognized at get requests are:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:205
#: ../../../networking/nexthop-group-resilient.rst:223
msgid "``NHA_ID``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:205
msgid "ID of the next-hop group that the bucket belongs to."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:206
#: ../../../networking/nexthop-group-resilient.rst:229
msgid "``NHA_RES_BUCKET``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:206
#: ../../../networking/nexthop-group-resilient.rst:229
msgid "A nest that contains attributes specific to bucket."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:209
#: ../../../networking/nexthop-group-resilient.rst:232
msgid "``NHA_RES_BUCKET`` payload:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:212
msgid "``NHA_RES_BUCKET_INDEX``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:212
msgid "Index of bucket in the resilient table."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:216
msgid "Bucket Dumps"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:218
msgid ""
"The message ``RTM_GETNEXTHOPBUCKET`` with the ``NLM_F_DUMP`` flag is used to "
"request a dump of matching buckets. The attributes recognized at dump "
"requests are:"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:223
msgid "If specified, limits the dump to just the next-hop group with this ID."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:225
msgid "``NHA_OIF``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:225
msgid ""
"If specified, limits the dump to buckets that contain next hops that use the "
"device with this ifindex."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:227
msgid "``NHA_MASTER``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:227
msgid ""
"If specified, limits the dump to buckets that contain next hops that use a "
"device in the VRF with this ifindex."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:235
msgid "``NHA_RES_BUCKET_NH_ID``"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:235
msgid ""
"If specified, limits the dump to just the buckets that contain the next hop "
"with this ID."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:240
msgid "Usage"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:242
msgid "To illustrate the usage, consider the following commands::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:249
msgid ""
"The last command creates a resilient next-hop group. It will have 8 buckets "
"(which is unusually low number, and used here for demonstration purposes "
"only), each bucket will be considered idle when no traffic hits it for at "
"least 60 seconds, and if the table remains out of balance for 300 seconds, "
"it will be forcefully brought into balance."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:255
msgid "Changing next-hop weights leads to change in bucket allocation::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:259
msgid "This can be confirmed by looking at individual buckets::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:271
msgid ""
"Note the two buckets that have a shorter idle time. Those are the ones that "
"were migrated after the next-hop replace command to satisfy the new demand "
"that next hop 1 be given 6 buckets instead of 4."
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:276
msgid "Netdevsim"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:278
msgid ""
"The netdevsim driver implements a mock offload of resilient groups, and "
"exposes debugfs interface that allows marking individual buckets as busy. "
"For example, the following will mark bucket 23 in next-hop group 10 as "
"active::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:285
msgid ""
"In addition, another debugfs interface can be used to configure that the "
"next attempt to migrate a bucket should fail::"
msgstr ""

#: ../../../networking/nexthop-group-resilient.rst:290
msgid ""
"Besides serving as an example, the interfaces that netdevsim exposes are "
"useful in automated testing, and ``tools/testing/selftests/drivers/net/"
"netdevsim/nexthop.sh`` makes use of them to test the algorithm."
msgstr ""

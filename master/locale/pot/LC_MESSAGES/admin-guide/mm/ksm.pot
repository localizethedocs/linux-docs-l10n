# SOME DESCRIPTIVE TITLE.
# Copyright (C) The kernel development community
# This file is distributed under the same license as the The Linux Kernel package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: The Linux Kernel master\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-09-29 08:26+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: ../../../admin-guide/mm/ksm.rst:3
msgid "Kernel Samepage Merging"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:6
msgid "Overview"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:8
msgid ""
"KSM is a memory-saving de-duplication feature, enabled by CONFIG_KSM=y, "
"added to the Linux kernel in 2.6.32.  See ``mm/ksm.c`` for its "
"implementation, and http://lwn.net/Articles/306704/ and https://lwn.net/"
"Articles/330589/"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:12
msgid ""
"KSM was originally developed for use with KVM (where it was known as Kernel "
"Shared Memory), to fit more virtual machines into physical memory, by "
"sharing the data common between them.  But it can be useful to any "
"application which generates many instances of the same data."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:17
msgid ""
"The KSM daemon ksmd periodically scans those areas of user memory which have "
"been registered with it, looking for pages of identical content which can be "
"replaced by a single write-protected page (which is automatically copied if "
"a process later wants to update its content). The amount of pages that KSM "
"daemon scans in a single pass and the time between the passes are configured "
"using :ref:`sysfs interface <ksm_sysfs>`"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:25
msgid ""
"KSM only merges anonymous (private) pages, never pagecache (file) pages. "
"KSM's merged pages were originally locked into kernel memory, but can now be "
"swapped out just like other user pages (but sharing is broken when they are "
"swapped back in: ksmd must rediscover their identity and merge again)."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:31
msgid "Controlling KSM with madvise"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:33
msgid ""
"KSM only operates on those areas of address space which an application has "
"advised to be likely candidates for merging, by using the madvise(2) system "
"call::"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:39
msgid "The app may call"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:45
msgid ""
"to cancel that advice and restore unshared pages: whereupon KSM unmerges "
"whatever it merged in that range.  Note: this unmerging call may suddenly "
"require more memory than is available - possibly failing with EAGAIN, but "
"more probably arousing the Out-Of-Memory killer."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:50
msgid ""
"If KSM is not configured into the running kernel, madvise MADV_MERGEABLE and "
"MADV_UNMERGEABLE simply fail with EINVAL.  If the running kernel was built "
"with CONFIG_KSM=y, those calls will normally succeed: even if the KSM daemon "
"is not currently running, MADV_MERGEABLE still registers the range for "
"whenever the KSM daemon is started; even if the range cannot contain any "
"pages which KSM could actually merge; even if MADV_UNMERGEABLE is applied to "
"a range which was never MADV_MERGEABLE."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:58
msgid ""
"If a region of memory must be split into at least one new MADV_MERGEABLE or "
"MADV_UNMERGEABLE region, the madvise may return ENOMEM if the process will "
"exceed ``vm.max_map_count`` (see Documentation/admin-guide/sysctl/vm.rst)."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:62
msgid ""
"Like other madvise calls, they are intended for use on mapped areas of the "
"user address space: they will report ENOMEM if the specified range includes "
"unmapped gaps (though working on the intervening mapped areas), and might "
"fail with EAGAIN if not enough memory for internal structures."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:67
msgid ""
"Applications should be considerate in their use of MADV_MERGEABLE, "
"restricting its use to areas likely to benefit.  KSM's scans may use a lot "
"of processing power: some installations will disable KSM for that reason."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:74
msgid "KSM daemon sysfs interface"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:76
msgid ""
"The KSM daemon is controlled by sysfs files in ``/sys/kernel/mm/ksm/``, "
"readable by all but writable only by root:"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:79
msgid "pages_to_scan"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:80
msgid ""
"how many pages to scan before ksmd goes to sleep e.g. ``echo 100 > /sys/"
"kernel/mm/ksm/pages_to_scan``."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:83
msgid ""
"The pages_to_scan value cannot be changed if ``advisor_mode`` has been set "
"to scan-time."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:86
msgid "Default: 100 (chosen for demonstration purposes)"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:88
msgid "sleep_millisecs"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:89
msgid ""
"how many milliseconds ksmd should sleep before next scan e.g. ``echo 20 > /"
"sys/kernel/mm/ksm/sleep_millisecs``"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:92
msgid "Default: 20 (chosen for demonstration purposes)"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:94
msgid "merge_across_nodes"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:95
msgid ""
"specifies if pages from different NUMA nodes can be merged. When set to 0, "
"ksm merges only pages which physically reside in the memory area of same "
"NUMA node. That brings lower latency to access of shared pages. Systems with "
"more nodes, at significant NUMA distances, are likely to benefit from the "
"lower latency of setting 0. Smaller systems, which need to minimize memory "
"usage, are likely to benefit from the greater sharing of setting 1 "
"(default). You may wish to compare how your system performs under each "
"setting, before deciding on which to use. ``merge_across_nodes`` setting can "
"be changed only when there are no ksm shared pages in the system: set run 2 "
"to unmerge pages first, then to 1 after changing ``merge_across_nodes``, to "
"remerge according to the new setting."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:109
msgid "Default: 1 (merging across nodes as in earlier releases)"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:111
msgid "run"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:112
msgid "set to 0 to stop ksmd from running but keep merged pages,"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:113
msgid "set to 1 to run ksmd e.g. ``echo 1 > /sys/kernel/mm/ksm/run``,"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:114
msgid ""
"set to 2 to stop ksmd and unmerge all pages currently merged, but leave "
"mergeable areas registered for next run."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:117
msgid ""
"Default: 0 (must be changed to 1 to activate KSM, except if CONFIG_SYSFS is "
"disabled)"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:120
msgid "use_zero_pages"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:121
msgid ""
"specifies whether empty pages (i.e. allocated pages that only contain "
"zeroes) should be treated specially.  When set to 1, empty pages are merged "
"with the kernel zero page(s) instead of with each other as it would happen "
"normally. This can improve the performance on architectures with coloured "
"zero pages, depending on the workload. Care should be taken when enabling "
"this setting, as it can potentially degrade the performance of KSM for some "
"workloads, for example if the checksums of pages candidate for merging match "
"the checksum of an empty page. This setting can be changed at any time, it "
"is only effective for pages merged after the change."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:133
msgid "Default: 0 (normal KSM behaviour as in earlier releases)"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:135
msgid "max_page_sharing"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:136
msgid ""
"Maximum sharing allowed for each KSM page. This enforces a deduplication "
"limit to avoid high latency for virtual memory operations that involve "
"traversal of the virtual mappings that share the KSM page. The minimum value "
"is 2 as a newly created KSM page will have at least two sharers. The higher "
"this value the faster KSM will merge the memory and the higher the "
"deduplication factor will be, but the slower the worst case virtual mappings "
"traversal could be for any given KSM page. Slowing down this traversal means "
"there will be higher latency for certain virtual memory operations happening "
"during swapping, compaction, NUMA balancing and page migration, in turn "
"decreasing responsiveness for the caller of those virtual memory operations. "
"The scheduler latency of other tasks not involved with the VM operations "
"doing the virtual mappings traversal is not affected by this parameter as "
"these traversals are always schedule friendly themselves."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:153
msgid "stable_node_chains_prune_millisecs"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:154
msgid ""
"specifies how frequently KSM checks the metadata of the pages that hit the "
"deduplication limit for stale information. Smaller milllisecs values will "
"free up the KSM metadata with lower latency, but they will make ksmd use "
"more CPU during the scan. It's a noop if not a single KSM page hit the "
"``max_page_sharing`` yet."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:161
msgid "smart_scan"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:162
msgid ""
"Historically KSM checked every candidate page for each scan. It did not take "
"into account historic information.  When smart scan is enabled, pages that "
"have previously not been de-duplicated get skipped. How often these pages "
"are skipped depends on how often de-duplication has already been tried and "
"failed. By default this optimization is enabled.  The ``pages_skipped`` "
"metric shows how effective the setting is."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:170
msgid "advisor_mode"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:171
msgid ""
"The ``advisor_mode`` selects the current advisor. Two modes are supported: "
"none and scan-time. The default is none. By setting ``advisor_mode`` to scan-"
"time, the scan time advisor is enabled. The section about ``advisor`` "
"explains in detail how the scan time advisor works."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:177
msgid "adivsor_max_cpu"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:178
msgid ""
"specifies the upper limit of the cpu percent usage of the ksmd background "
"thread. The default is 70."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:181
msgid "advisor_target_scan_time"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:182
msgid ""
"specifies the target scan time in seconds to scan all the candidate pages. "
"The default value is 200 seconds."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:185
msgid "advisor_min_pages_to_scan"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:186
msgid ""
"specifies the lower limit of the ``pages_to_scan`` parameter of the scan "
"time advisor. The default is 500."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:189
msgid "adivsor_max_pages_to_scan"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:190
msgid ""
"specifies the upper limit of the ``pages_to_scan`` parameter of the scan "
"time advisor. The default is 30000."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:193
msgid ""
"The effectiveness of KSM and MADV_MERGEABLE is shown in ``/sys/kernel/mm/ksm/"
"``:"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:195
msgid "general_profit"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:196
msgid "how effective is KSM. The calculation is explained below."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:197
msgid "pages_scanned"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:198
msgid "how many pages are being scanned for ksm"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:199
msgid "pages_shared"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:200
msgid "how many shared pages are being used"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:201
msgid "pages_sharing"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:202
msgid "how many more sites are sharing them i.e. how much saved"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:203
msgid "pages_unshared"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:204
msgid "how many pages unique but repeatedly checked for merging"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:205
msgid "pages_volatile"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:206
msgid "how many pages changing too fast to be placed in a tree"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:207
msgid "pages_skipped"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:208
msgid "how many pages did the \"smart\" page scanning algorithm skip"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:209
msgid "full_scans"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:210
msgid "how many times all mergeable areas have been scanned"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:211
msgid "stable_node_chains"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:212
msgid "the number of KSM pages that hit the ``max_page_sharing`` limit"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:213
msgid "stable_node_dups"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:214
msgid "number of duplicated KSM pages"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:215
msgid "ksm_zero_pages"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:216
msgid ""
"how many zero pages that are still mapped into processes were mapped by KSM "
"when deduplicating."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:219
msgid ""
"When ``use_zero_pages`` is/was enabled, the sum of ``pages_sharing`` + "
"``ksm_zero_pages`` represents the actual number of pages saved by KSM. if "
"``use_zero_pages`` has never been enabled, ``ksm_zero_pages`` is 0."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:223
msgid ""
"A high ratio of ``pages_sharing`` to ``pages_shared`` indicates good "
"sharing, but a high ratio of ``pages_unshared`` to ``pages_sharing`` "
"indicates wasted effort.  ``pages_volatile`` embraces several different "
"kinds of activity, but a high proportion there would also indicate poor use "
"of madvise MADV_MERGEABLE."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:229
msgid ""
"The maximum possible ``pages_sharing/pages_shared`` ratio is limited by the "
"``max_page_sharing`` tunable. To increase the ratio ``max_page_sharing`` "
"must be increased accordingly."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:234
msgid "Monitoring KSM profit"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:236
msgid ""
"KSM can save memory by merging identical pages, but also can consume "
"additional memory, because it needs to generate a number of rmap_items to "
"save each scanned page's brief rmap information. Some of these pages may be "
"merged, but some may not be abled to be merged after being checked several "
"times, which are unprofitable memory consumed."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:242
msgid ""
"How to determine whether KSM save memory or consume memory in system-wide "
"range? Here is a simple approximate calculation for reference::"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:248
msgid ""
"where ksm_saved_pages equals to the sum of ``pages_sharing`` + "
"``ksm_zero_pages`` of the system, and all_rmap_items can be easily obtained "
"by summing ``pages_sharing``, ``pages_shared``, ``pages_unshared`` and "
"``pages_volatile``."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:253
msgid ""
"The KSM profit inner a single process can be similarly obtained by the "
"following approximate calculation::"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:259
msgid ""
"where ksm_saved_pages equals to the sum of ``ksm_merging_pages`` and "
"``ksm_zero_pages``, both of which are shown under the directory ``/proc/"
"<pid>/ksm_stat``, and ksm_rmap_items is also shown in ``/proc/<pid>/"
"ksm_stat``. The process profit is also shown in ``/proc/<pid>/ksm_stat`` as "
"ksm_process_profit."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:265
msgid ""
"From the perspective of application, a high ratio of ``ksm_rmap_items`` to "
"``ksm_merging_pages`` means a bad madvise-applied policy, so developers or "
"administrators have to rethink how to change madvise policy. Giving an "
"example for reference, a page's size is usually 4K, and the rmap_item's size "
"is separately 32B on 32-bit CPU architecture and 64B on 64-bit CPU "
"architecture. so if the ``ksm_rmap_items/ksm_merging_pages`` ratio exceeds "
"64 on 64-bit CPU or exceeds 128 on 32-bit CPU, then the app's madvise policy "
"should be dropped, because the ksm profit is approximately zero or negative."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:275
msgid "Monitoring KSM events"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:277
msgid ""
"There are some counters in /proc/vmstat that may be used to monitor KSM "
"events. KSM might help save memory, it's a tradeoff by may suffering delay "
"on KSM COW or on swapping in copy. Those events could help users evaluate "
"whether or how to use KSM. For example, if cow_ksm increases too fast, user "
"may decrease the range of madvise(, , MADV_MERGEABLE)."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:283
msgid "cow_ksm"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:284
msgid ""
"is incremented every time a KSM page triggers copy on write (COW) when users "
"try to write to a KSM page, we have to make a copy."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:287
msgid "ksm_swpin_copy"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:288
msgid ""
"is incremented every time a KSM page is copied when swapping in note that "
"KSM page might be copied when swapping in because do_swap_page() cannot do "
"all the locking needed to reconstitute a cross-anon_vma KSM page."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:293
msgid "Advisor"
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:295
msgid ""
"The number of candidate pages for KSM is dynamic. It can be often observed "
"that during the startup of an application more candidate pages need to be "
"processed. Without an advisor the ``pages_to_scan`` parameter needs to be "
"sized for the maximum number of candidate pages. The scan time advisor can "
"changes the ``pages_to_scan`` parameter based on demand."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:301
msgid ""
"The advisor can be enabled, so KSM can automatically adapt to changes in the "
"number of candidate pages to scan. Two advisors are implemented: none and "
"scan-time. With none, no advisor is enabled. The default is none."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:305
msgid ""
"The scan time advisor changes the ``pages_to_scan`` parameter based on the "
"observed scan times. The possible values for the ``pages_to_scan`` parameter "
"is limited by the ``advisor_max_cpu`` parameter. In addition there is also "
"the ``advisor_target_scan_time`` parameter. This parameter sets the target "
"time to scan all the KSM candidate pages. The parameter "
"``advisor_target_scan_time`` decides how aggressive the scan time advisor "
"scans candidate pages. Lower values make the scan time advisor to scan more "
"aggressively. This is the most important parameter for the configuration of "
"the scan time advisor."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:314
msgid ""
"The initial value and the maximum value can be changed with "
"``advisor_min_pages_to_scan`` and ``advisor_max_pages_to_scan``. The default "
"values are sufficient for most workloads and use cases."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:318
msgid ""
"The ``pages_to_scan`` parameter is re-calculated after a scan has been "
"completed."
msgstr ""

#: ../../../admin-guide/mm/ksm.rst:321
msgid "-- Izik Eidus, Hugh Dickins, 17 Nov 2009"
msgstr ""

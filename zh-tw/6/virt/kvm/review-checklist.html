<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Review checklist for kvm patches &#8212; The Linux Kernel unknown version 說明文件</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../_static/documentation_options.js?v=b446b479"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/virt/kvm/review-checklist.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />
    <link rel="next" title="UML HowTo" href="../uml/user_mode_linux_howto_v2.html" />
    <link rel="prev" title="The KVM halt polling system" href="halt-polling.html" />

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">核心 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">子系統</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../subsystem-apis.html#other-subsystems">其他子系統</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpu-freq/index.html">CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../edac/index.html">EDAC 子系統</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fpga/index.html">FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../pcmcia/index.html">PCMCIA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../watchdog/index.html">Watchdog 支援</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Virtualization Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hwmon/index.html">Hardware Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../accel/index.html">Compute Accelerators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../crypto/index.html">Crypto API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bpf/index.html">BPF 文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../PCI/index.html">PCI Bus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../peci/index.html">PECI 子系統</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../wmi/index.html">WMI 子系統</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tee/index.html">TEE Subsystem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">即時補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/virt/kvm/review-checklist.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="review-checklist-for-kvm-patches">
<h1>Review checklist for kvm patches<a class="headerlink" href="#review-checklist-for-kvm-patches" title="連結到這個標頭">¶</a></h1>
<ol class="arabic simple">
<li><p>The patch must follow <a class="reference internal" href="../../process/coding-style.html"><span class="doc">Linux kernel coding style</span></a> and
<a class="reference internal" href="../../process/submitting-patches.html"><span class="doc">Submitting patches: the essential guide to getting your code into the kernel</span></a>.</p></li>
<li><p>Patches should be against kvm.git master or next branches.</p></li>
<li><p>If the patch introduces or modifies a new userspace API:
- the API must be documented in <a class="reference internal" href="api.html"><span class="doc">The Definitive KVM (Kernel-based Virtual Machine) API Documentation</span></a>
- the API must be discoverable using KVM_CHECK_EXTENSION</p></li>
<li><p>New state must include support for save/restore.</p></li>
<li><p>New features must default to off (userspace should explicitly request them).
Performance improvements can and should default to on.</p></li>
<li><p>New cpu features should be exposed via KVM_GET_SUPPORTED_CPUID2,
or its equivalent for non-x86 architectures</p></li>
<li><p>The feature should be testable (see below).</p></li>
<li><p>Changes should be vendor neutral when possible.  Changes to common code
are better than duplicating changes to vendor code.</p></li>
<li><p>Similarly, prefer changes to arch independent code than to arch dependent
code.</p></li>
<li><p>User/kernel interfaces and guest/host interfaces must be 64-bit clean
(all variables and sizes naturally aligned on 64-bit; use specific types
only - u64 rather than ulong).</p></li>
<li><p>New guest visible features must either be documented in a hardware manual
or be accompanied by documentation.</p></li>
</ol>
<section id="testing-of-kvm-code">
<h2>Testing of KVM code<a class="headerlink" href="#testing-of-kvm-code" title="連結到這個標頭">¶</a></h2>
<p>All features contributed to KVM, and in many cases bugfixes too, should be
accompanied by some kind of tests and/or enablement in open source guests
and VMMs.  KVM is covered by multiple test suites:</p>
<dl class="simple">
<dt><em>Selftests</em></dt><dd><p>These are low level tests that allow granular testing of kernel APIs.
This includes API failure scenarios, invoking APIs after specific
guest instructions, and testing multiple calls to <code class="docutils literal notranslate"><span class="pre">KVM_CREATE_VM</span></code>
within a single test.  They are included in the kernel tree at
<code class="docutils literal notranslate"><span class="pre">tools/testing/selftests/kvm</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code></dt><dd><p>A collection of small guests that test CPU and emulated device features
from a guest's perspective.  They run under QEMU or <code class="docutils literal notranslate"><span class="pre">kvmtool</span></code>, and
are generally not KVM-specific: they can be run with any accelerator
that QEMU support or even on bare metal, making it possible to compare
behavior across hypervisors and processor families.</p>
</dd>
<dt>Functional test suites</dt><dd><p>Various sets of functional tests exist, such as QEMU's <code class="docutils literal notranslate"><span class="pre">tests/functional</span></code>
suite and <a class="reference external" href="https://avocado-vt.readthedocs.io/en/latest/">avocado-vt</a>.
These typically involve running a full operating system in a virtual
machine.</p>
</dd>
</dl>
<p>The best testing approach depends on the feature's complexity and
operation. Here are some examples and guidelines:</p>
<dl class="simple">
<dt>New instructions (no new registers or APIs)</dt><dd><p>The corresponding CPU features (if applicable) should be made available
in QEMU.  If the instructions require emulation support or other code in
KVM, it is worth adding coverage to <code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code> or selftests;
the latter can be a better choice if the instructions relate to an API
that already has good selftest coverage.</p>
</dd>
<dt>New hardware features (new registers, no new APIs)</dt><dd><p>These should be tested via <code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code>; this more or less implies
supporting them in QEMU and/or <code class="docutils literal notranslate"><span class="pre">kvmtool</span></code>.  In some cases selftests
can be used instead, similar to the previous case, or specifically to
test corner cases in guest state save/restore.</p>
</dd>
<dt>Bug fixes and performance improvements</dt><dd><p>These usually do not introduce new APIs, but it's worth sharing
any benchmarks and tests that will validate your contribution,
ideally in the form of regression tests.  Tests and benchmarks
can be included in either <code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code> or selftests, depending
on the specifics of your change.  Selftests are especially useful for
regression tests because they are included directly in Linux's tree.</p>
</dd>
<dt>Large scale internal changes</dt><dd><p>While it's difficult to provide a single policy, you should ensure that
the changed code is covered by either <code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code> or selftests.
In some cases the affected code is run for any guests and functional
tests suffice.  Explain your testing process in the cover letter,
as that can help identify gaps in existing test suites.</p>
</dd>
<dt>New APIs</dt><dd><p>It is important to demonstrate your use case.  This can be as simple as
explaining that the feature is already in use on bare metal, or it can be
a proof-of-concept implementation in userspace.  The latter need not be
open source, though that is of course preferable for easier testing.
Selftests should test corner cases of the APIs, and should also cover
basic host and guest operation if no open source VMM uses the feature.</p>
</dd>
<dt>Bigger features, usually spanning host and guest</dt><dd><p>These should be supported by Linux guests, with limited exceptions for
Hyper-V features that are testable on Windows guests.  It is strongly
suggested that the feature be usable with an open source host VMM, such
as at least one of QEMU or crosvm, and guest firmware.  Selftests should
test at least API error cases.  Guest operation can be covered by
either selftests of <code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code> (this is especially important for
paravirtualized and Windows-only features).  Strong selftest coverage
can also be a replacement for implementation in an open source VMM,
but this is generally not recommended.</p>
</dd>
</dl>
<p>Following the above suggestions for testing in selftests and
<code class="docutils literal notranslate"><span class="pre">kvm-unit-tests</span></code> will make it easier for the maintainers to review
and accept your code.  In fact, even before you contribute your changes
upstream it will make it easier for you to develop for KVM.</p>
<p>Of course, the KVM maintainers reserve the right to require more tests,
though they may also waive the requirement from time to time.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/virt/kvm/review-checklist.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
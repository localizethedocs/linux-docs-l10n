<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>記憶體熱插拔 &#8212; The Linux Kernel unknown version 說明文件</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../../_static/documentation_options.js?v=b446b479"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/driver-api/cxl/linux/memory-hotplug.html" />
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜尋" href="../../../search.html" />
    <link rel="next" title="CXL Access Coordinates Computation" href="access-coordinates.html" />
    <link rel="prev" title="DAX Driver Operation" href="dax-driver.html" />

   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">核心 API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#bus-level-documentation">Bus-level documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Compute Express Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eisa.html">EISA bus support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../isa.html">ISA Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../pci/index.html">The Linux PCI driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rapidio/index.html">Linux RapidIO 子系統</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usb/index.html">Linux USB API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../virtio/index.html">Virtio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vme.html">VME Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../w1.html">W1: Dallas' 1-wire bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#subsystem-specific-apis">Subsystem-specific APIs</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../subsystem-apis.html">子系統</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../subsystem-apis.html#core-subsystems">Core subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../core-api/index.html">核心 API 文件</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">Driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../mm/index.html">記憶體管理文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../power/index.html">電源管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../timers/index.html">計時器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#other-subsystems">其他子系統</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">即時補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/driver-api/cxl/linux/memory-hotplug.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="memory-hotplug">
<h1>記憶體熱插拔<a class="headerlink" href="#memory-hotplug" title="連結到這個標頭">¶</a></h1>
<p>The final phase of surfacing CXL memory to the kernel page allocator is for
the <cite>DAX</cite> driver to surface a <cite>Driver Managed</cite> memory region via the
memory-hotplug component.</p>
<p>There are four major configurations to consider:</p>
<ol class="arabic simple">
<li><p>Default Online Behavior (on/off and zone)</p></li>
<li><p>Hotplug Memory Block size</p></li>
<li><p>Memory Map Resource location</p></li>
<li><p>Driver-Managed Memory Designation</p></li>
</ol>
<section id="default-online-behavior">
<h2>Default Online Behavior<a class="headerlink" href="#default-online-behavior" title="連結到這個標頭">¶</a></h2>
<p>The default-online behavior of hotplug memory is dictated by the following,
in order of precedence:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">CONFIG_MHP_DEFAULT_ONLINE_TYPE</span></code> Build Configuration</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">memhp_default_state</span></code> Boot parameter</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">/sys/devices/system/memory/auto_online_blocks</span></code> value</p></li>
</ul>
<p>These dictate whether hotplugged memory blocks arrive in one of three states:</p>
<ol class="arabic simple">
<li><p>Offline</p></li>
<li><p>Online in <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code></p></li>
<li><p>Online in <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code></p></li>
</ol>
<p><code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> implies this capacity may be used for almost any allocation,
while <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> implies this capacity should only be used for
migratable allocations.</p>
<p><code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> attempts to retain the hotplug-ability of a memory block
so that it the entire region may be hot-unplugged at a later time.  Any capacity
onlined into <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> should be considered permanently attached to
the page allocator.</p>
</section>
<section id="hotplug-memory-block-size">
<h2>Hotplug Memory Block Size<a class="headerlink" href="#hotplug-memory-block-size" title="連結到這個標頭">¶</a></h2>
<p>By default, on most architectures, the Hotplug Memory Block Size is either
128MB or 256MB.  On x86, the block size increases up to 2GB as total memory
capacity exceeds 64GB.  As of v6.15, Linux does not take into account the
size and alignment of the ACPI CEDT CFMWS regions (see Early Boot docs) when
deciding the Hotplug Memory Block Size.</p>
</section>
<section id="memory-map">
<h2>Memory Map<a class="headerlink" href="#memory-map" title="連結到這個標頭">¶</a></h2>
<p>The location of <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> allocations to represent the hotplugged
memory capacity are dictated by the following system settings:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">/sys_module/memory_hotplug/parameters/memmap_on_memory</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">/sys/bus/dax/devices/daxN.Y/memmap_on_memory</span></code></p></li>
</ul>
<p>If both of these parameters are set to true, <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> for this
capacity will be carved out of the memory block being onlined.  This has
performance implications if the memory is particularly high-latency and
its <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> becomes hotly contended.</p>
<p>If either parameter is set to false, <code class="code docutils literal notranslate"><span class="pre">struct</span> <span class="pre">folio</span></code> for this capacity
will be allocated from the local node of the processor running the hotplug
procedure.  This capacity will be allocated from <code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> on
that node, as it is a <code class="code docutils literal notranslate"><span class="pre">GFP_KERNEL</span></code> allocation.</p>
<p>Systems with extremely large amounts of <code class="code docutils literal notranslate"><span class="pre">ZONE_MOVABLE</span></code> memory (e.g.
CXL memory pools) must ensure that there is sufficient local
<code class="code docutils literal notranslate"><span class="pre">ZONE_NORMAL</span></code> capacity to host the memory map for the hotplugged capacity.</p>
</section>
<section id="driver-managed-memory">
<h2>Driver Managed Memory<a class="headerlink" href="#driver-managed-memory" title="連結到這個標頭">¶</a></h2>
<p>The DAX driver surfaces this memory to memory-hotplug as &quot;Driver Managed&quot;. This
is not a configurable setting, but it's important to note that driver managed
memory is explicitly excluded from use during kexec.  This is required to ensure
any reset or out-of-band operations that the CXL device may be subject to during
a functional system-reboot (such as a reset-on-probe) will not cause portions of
the kexec kernel to be overwritten.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/driver-api/cxl/linux/memory-hotplug.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
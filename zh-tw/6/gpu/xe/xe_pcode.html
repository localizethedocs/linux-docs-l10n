<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pcode &#8212; The Linux Kernel unknown version 說明文件</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../_static/documentation_options.js?v=b446b479"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/gpu/xe/xe_pcode.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />
    <link rel="next" title="GT Multicast/Replicated (MCR) Register Support" href="xe_gt_mcr.html" />
    <link rel="prev" title="Xe GT Frequency Management" href="xe_gt_freq.html" />

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">核心 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">子系統</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../subsystem-apis.html#human-interfaces">Human interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../input/index.html">輸入文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sound/index.html">Sound Subsystem Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">GPU Driver Developer's Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#other-subsystems">其他子系統</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">即時補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/gpu/xe/xe_pcode.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pcode">
<h1>Pcode<a class="headerlink" href="#pcode" title="連結到這個標頭">¶</a></h1>
<p>Xe PCODE is the component responsible for interfacing with the PCODE
firmware.
It shall provide a very simple ABI to other Xe components, but be the
single and consolidated place that will communicate with PCODE. All read
and write operations to PCODE will be internal and private to this component.</p>
<p>What's next:
- PCODE hw metrics
- PCODE for display operations</p>
<section id="internal-api">
<h2>Internal API<a class="headerlink" href="#internal-api" title="連結到這個標頭">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.xe_pcode_request">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xe_pcode_request</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">xe_tile</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tile</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">mbox</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">request</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">reply_mask</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">reply</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">timeout_base_ms</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xe_pcode_request" title="連結到這個定義">¶</a><br /></dt>
<dd><p>send PCODE request until acknowledgment</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">xe_tile</span> <span class="pre">*tile</span></code></dt><dd><p>tile</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">mbox</span></code></dt><dd><p>PCODE mailbox ID the request is targeted for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">request</span></code></dt><dd><p>request ID</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">reply_mask</span></code></dt><dd><p>mask used to check for request acknowledgment</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">reply</span></code></dt><dd><p>value used to check for request acknowledgment</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">timeout_base_ms</span></code></dt><dd><p>timeout for polling with preemption enabled</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Keep resending the <strong>request</strong> to <strong>mbox</strong> until PCODE acknowledges it, PCODE
reports an error or an overall timeout of <strong>timeout_base_ms**+50 ms expires.
The request is acknowledged once the PCODE reply dword equals **reply</strong> after
applying <strong>reply_mask</strong>. Polling is first attempted with preemption enabled
for <strong>timeout_base_ms</strong> and if this times out for another 50 ms with
preemption disabled.</p>
<p>Returns 0 on success, <code class="docutils literal notranslate"><span class="pre">-ETIMEDOUT</span></code> in case of a timeout, &lt;0 in case of some
other error as reported by PCODE.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xe_pcode_init_min_freq_table">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xe_pcode_init_min_freq_table</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">xe_tile</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tile</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">min_gt_freq</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">max_gt_freq</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xe_pcode_init_min_freq_table" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Initialize PCODE's QOS frequency table</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">xe_tile</span> <span class="pre">*tile</span></code></dt><dd><p>tile instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">min_gt_freq</span></code></dt><dd><p>Minimal (RPn) GT frequency in units of 50MHz.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">max_gt_freq</span></code></dt><dd><p>Maximal (RP0) GT frequency in units of 50MHz.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function initialize PCODE's QOS frequency table for a proper minimal
frequency/power steering decision, depending on the current requested GT
frequency. For older platforms this was a more complete table including
the IA freq. However for the latest platforms this table become a simple
1-1 Ring vs GT frequency. Even though, without setting it, PCODE might
not take the right decisions for some memory frequencies and affect latency.</p>
<p>It returns 0 on success, and -ERROR number on failure, -EINVAL if max
frequency is higher then the minimal, and other errors directly translated
from the PCODE Error returns:
- -ENXIO: &quot;Illegal Command&quot;
- -ETIMEDOUT: &quot;Timed out&quot;
- -EINVAL: &quot;Illegal Data&quot;
- -ENXIO, &quot;Illegal Subcommand&quot;
- -EBUSY: &quot;PCODE Locked&quot;
- -EOVERFLOW, &quot;GT ratio out of range&quot;
- -EACCES, &quot;PCODE Rejected&quot;
- -EPROTO, &quot;Unknown&quot;</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xe_pcode_ready">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xe_pcode_ready</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">xe_device</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xe</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">locked</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xe_pcode_ready" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Ensure PCODE is initialized</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">xe_device</span> <span class="pre">*xe</span></code></dt><dd><p>xe instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">locked</span></code></dt><dd><p>true if lock held, false otherwise</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>PCODE init mailbox is polled only on root gt of root tile
as the root tile provides the initialization is complete only
after all the tiles have completed the initialization.
Called only on early probe without locks and with locks in
resume path.</p>
<p>Returns 0 on success, and -error number on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xe_pcode_init">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xe_pcode_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">xe_tile</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tile</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xe_pcode_init" title="連結到這個定義">¶</a><br /></dt>
<dd><p>initialize components of PCODE</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">xe_tile</span> <span class="pre">*tile</span></code></dt><dd><p>tile instance</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function initializes the xe_pcode component.
To be called once only during probe.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.xe_pcode_probe_early">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xe_pcode_probe_early</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">xe_device</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">xe</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xe_pcode_probe_early" title="連結到這個定義">¶</a><br /></dt>
<dd><p>initializes PCODE</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">xe_device</span> <span class="pre">*xe</span></code></dt><dd><p>xe instance</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function checks the initialization status of PCODE
To be called once only during early probe without locks.</p>
<p>Returns 0 on success, error code otherwise</p>
</div>
</section>
</section>
<section id="survivability-mode">
<span id="xe-survivability-mode"></span><h1>Survivability Mode<a class="headerlink" href="#survivability-mode" title="連結到這個標頭">¶</a></h1>
<p>Survivability Mode is a software based workflow for recovering a system in a failed boot state
Here system recoverability is concerned with recovering the firmware responsible for boot.</p>
<section id="boot-survivability">
<h2>Boot Survivability<a class="headerlink" href="#boot-survivability" title="連結到這個標頭">¶</a></h2>
<p>Boot Survivability is implemented by loading the driver with bare minimum (no drm card) to allow
the firmware to be flashed through mei driver and collect telemetry. The driver's probe flow is
modified such that it enters survivability mode when pcode initialization is incomplete and boot
status denotes a failure.</p>
<p>Survivability mode can also be entered manually using the survivability mode attribute available
through configfs which is beneficial in several usecases. It can be used to address scenarios
where pcode does not detect failure or for validation purposes. It can also be used in
In-Field-Repair (IFR) to repair a single card without impacting the other cards in a node.</p>
<p>Use below command enable survivability mode manually:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 1 &gt; /sys/kernel/config/xe/0000:03:00.0/survivability_mode
</pre></div>
</div>
<p>It is the responsibility of the user to clear the mode once firmware flash is complete.</p>
<p>Refer <a class="reference internal" href="xe_configfs.html#xe-configfs"><span class="std std-ref">Xe Configfs</span></a> for more details on how to use configfs</p>
<p>Survivability mode is indicated by the below admin-only readable sysfs which provides additional
debug information:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/bus/pci/devices/&lt;device&gt;/survivability_mode
</pre></div>
</div>
<dl class="simple">
<dt>Capability Information:</dt><dd><p>Provides boot status</p>
</dd>
<dt>Postcode Information:</dt><dd><p>Provides information about the failure</p>
</dd>
<dt>Overflow Information</dt><dd><p>Provides history of previous failures</p>
</dd>
<dt>Auxiliary Information</dt><dd><p>Certain failures may have information in addition to postcode information</p>
</dd>
</dl>
</section>
<section id="runtime-survivability">
<h2>Runtime Survivability<a class="headerlink" href="#runtime-survivability" title="連結到這個標頭">¶</a></h2>
<p>Certain runtime firmware errors can cause the device to enter a wedged state
(<a class="reference internal" href="xe_device.html#xe-device-wedging"><span class="std std-ref">Xe Device Wedging</span></a>) requiring a firmware flash to restore normal operation.
Runtime Survivability Mode indicates that a firmware flash is necessary to recover the device and
is indicated by the presence of survivability mode sysfs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/bus/pci/devices/&lt;device&gt;/survivability_mode
</pre></div>
</div>
<p>Survivability mode sysfs provides information about the type of survivability mode.</p>
<p>When such errors occur, userspace is notified with the drm device wedged uevent and runtime
survivability mode. User can then initiate a firmware flash using userspace tools like fwupd
to restore device to normal operation.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/gpu/xe/xe_pcode.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
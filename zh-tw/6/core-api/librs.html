<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Reed-Solomon Library Programming Interface &#8212; The Linux Kernel unknown version 說明文件</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=adfc0c0d" />
    <script src="../_static/documentation_options.js?v=b446b479"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/core-api/librs.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜尋" href="../search.html" />
    <link rel="next" title="Live Update Orchestrator" href="liveupdate.html" />
    <link rel="prev" title="Using physical DMA provided by OHCI-1394 FireWire controllers for debugging" href="debugging-via-ohci1394.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">核心 API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#core-utilities">Core utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-structures-and-low-level-utilities">Data structures and low-level utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#low-level-entry-and-exit">低階進入與退出</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#concurrency-primitives">Concurrency primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#low-level-hardware-management">Low-level hardware management</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#memory-management">記憶體管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interfaces-for-kernel-debugging">Interfaces for kernel debugging</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#everything-else">Everything else</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Reed-Solomon Library Programming Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="liveupdate.html">Live Update Orchestrator</a></li>
<li class="toctree-l3"><a class="reference internal" href="netlink.html">Netlink notes for kernel developers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystem-apis.html">子系統</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../subsystem-apis.html#core-subsystems">Core subsystems</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">核心 API 文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mm/index.html">記憶體管理文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../power/index.html">電源管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../timers/index.html">計時器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#other-subsystems">其他子系統</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">即時補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/core-api/librs.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="reed-solomon-library-programming-interface">
<h1>Reed-Solomon Library Programming Interface<a class="headerlink" href="#reed-solomon-library-programming-interface" title="連結到這個標頭">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">作者<span class="colon">:</span></dt>
<dd class="field-odd"><p>Thomas Gleixner</p>
</dd>
</dl>
<section id="introduction">
<h2>介紹<a class="headerlink" href="#introduction" title="連結到這個標頭">¶</a></h2>
<p>The generic Reed-Solomon Library provides encoding, decoding and error
correction functions.</p>
<p>Reed-Solomon codes are used in communication and storage applications to
ensure data integrity.</p>
<p>This documentation is provided for developers who want to utilize the
functions provided by the library.</p>
</section>
<section id="known-bugs-and-assumptions">
<h2>Known Bugs And Assumptions<a class="headerlink" href="#known-bugs-and-assumptions" title="連結到這個標頭">¶</a></h2>
<p>None.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="連結到這個標頭">¶</a></h2>
<p>This chapter provides examples of how to use the library.</p>
<section id="initializing">
<h3>Initializing<a class="headerlink" href="#initializing" title="連結到這個標頭">¶</a></h3>
<p>The init function init_rs returns a pointer to an rs decoder structure,
which holds the necessary information for encoding, decoding and error
correction with the given polynomial. It either uses an existing
matching decoder or creates a new one. On creation all the lookup tables
for fast en/decoding are created. The function may take a while, so make
sure not to call it in critical code paths.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* the Reed Solomon control structure */
static struct rs_control *rs_decoder;

/* Symbolsize is 10 (bits)
 * Primitive polynomial is x^10+x^3+1
 * first consecutive root is 0
 * primitive element to generate roots = 1
 * generator polynomial degree (number of roots) = 6
 */
rs_decoder = init_rs (10, 0x409, 0, 1, 6);
</pre></div>
</div>
</section>
<section id="encoding">
<h3>Encoding<a class="headerlink" href="#encoding" title="連結到這個標頭">¶</a></h3>
<p>The encoder calculates the Reed-Solomon code over the given data length
and stores the result in the parity buffer. Note that the parity buffer
must be initialized before calling the encoder.</p>
<p>The expanded data can be inverted on the fly by providing a non-zero
inversion mask. The expanded data is XOR'ed with the mask. This is used
e.g. for FLASH ECC, where the all 0xFF is inverted to an all 0x00. The
Reed-Solomon code for all 0x00 is all 0x00. The code is inverted before
storing to FLASH so it is 0xFF too. This prevents that reading from an
erased FLASH results in ECC errors.</p>
<p>The databytes are expanded to the given symbol size on the fly. There is
no support for encoding continuous bitstreams with a symbol size != 8 at
the moment. If it is necessary it should be not a big deal to implement
such functionality.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Parity buffer. Size = number of roots */
uint16_t par[6];
/* Initialize the parity buffer */
memset(par, 0, sizeof(par));
/* Encode 512 byte in data8. Store parity in buffer par */
encode_rs8 (rs_decoder, data8, 512, par, 0);
</pre></div>
</div>
</section>
<section id="decoding">
<h3>Decoding<a class="headerlink" href="#decoding" title="連結到這個標頭">¶</a></h3>
<p>The decoder calculates the syndrome over the given data length and the
received parity symbols and corrects errors in the data.</p>
<p>If a syndrome is available from a hardware decoder then the syndrome
calculation is skipped.</p>
<p>The correction of the data buffer can be suppressed by providing a
correction pattern buffer and an error location buffer to the decoder.
The decoder stores the calculated error location and the correction
bitmask in the given buffers. This is useful for hardware decoders which
use a weird bit ordering scheme.</p>
<p>The databytes are expanded to the given symbol size on the fly. There is
no support for decoding continuous bitstreams with a symbolsize != 8 at
the moment. If it is necessary it should be not a big deal to implement
such functionality.</p>
<section id="decoding-with-syndrome-calculation-direct-data-correction">
<h4>Decoding with syndrome calculation, direct data correction<a class="headerlink" href="#decoding-with-syndrome-calculation-direct-data-correction" title="連結到這個標頭">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Parity buffer. Size = number of roots */
uint16_t par[6];
uint8_t  data[512];
int numerr;
/* Receive data */
.....
/* Receive parity */
.....
/* Decode 512 byte in data8.*/
numerr = decode_rs8 (rs_decoder, data8, par, 512, NULL, 0, NULL, 0, NULL);
</pre></div>
</div>
</section>
<section id="decoding-with-syndrome-given-by-hardware-decoder-direct-data-correction">
<h4>Decoding with syndrome given by hardware decoder, direct data correction<a class="headerlink" href="#decoding-with-syndrome-given-by-hardware-decoder-direct-data-correction" title="連結到這個標頭">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Parity buffer. Size = number of roots */
uint16_t par[6], syn[6];
uint8_t  data[512];
int numerr;
/* Receive data */
.....
/* Receive parity */
.....
/* Get syndrome from hardware decoder */
.....
/* Decode 512 byte in data8.*/
numerr = decode_rs8 (rs_decoder, data8, par, 512, syn, 0, NULL, 0, NULL);
</pre></div>
</div>
</section>
<section id="decoding-with-syndrome-given-by-hardware-decoder-no-direct-data-correction">
<h4>Decoding with syndrome given by hardware decoder, no direct data correction.<a class="headerlink" href="#decoding-with-syndrome-given-by-hardware-decoder-no-direct-data-correction" title="連結到這個標頭">¶</a></h4>
<p>Note: It's not necessary to give data and received parity to the
decoder.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Parity buffer. Size = number of roots */
uint16_t par[6], syn[6], corr[8];
uint8_t  data[512];
int numerr, errpos[8];
/* Receive data */
.....
/* Receive parity */
.....
/* Get syndrome from hardware decoder */
.....
/* Decode 512 byte in data8.*/
numerr = decode_rs8 (rs_decoder, NULL, NULL, 512, syn, 0, errpos, 0, corr);
for (i = 0; i &lt; numerr; i++) {
    do_error_correction_in_your_buffer(errpos[i], corr[i]);
}
</pre></div>
</div>
</section>
</section>
<section id="cleanup">
<h3>Cleanup<a class="headerlink" href="#cleanup" title="連結到這個標頭">¶</a></h3>
<p>The function free_rs frees the allocated resources, if the caller is
the last user of the decoder.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Release resources */
free_rs(rs_decoder);
</pre></div>
</div>
</section>
</section>
<section id="structures">
<h2>Structures<a class="headerlink" href="#structures" title="連結到這個標頭">¶</a></h2>
<p>This chapter contains the autogenerated documentation of the structures
which are used in the Reed-Solomon Library and are relevant for a
developer.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.rs_codec">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">rs_codec</span></span></span><a class="headerlink" href="#c.rs_codec" title="連結到這個定義">¶</a><br /></dt>
<dd><p>rs codec data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct rs_codec {
    int mm;
    int nn;
    uint16_t *alpha_to;
    uint16_t *index_of;
    uint16_t *genpoly;
    int nroots;
    int fcr;
    int prim;
    int iprim;
    int gfpoly;
    int (*gffunc)(int);
    int users;
    struct list_head list;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mm</span></code></dt><dd><p>Bits per symbol</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nn</span></code></dt><dd><p>Symbols per block (= (1&lt;&lt;mm)-1)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alpha_to</span></code></dt><dd><p>log lookup table</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">index_of</span></code></dt><dd><p>Antilog lookup table</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">genpoly</span></code></dt><dd><p>Generator polynomial</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nroots</span></code></dt><dd><p>Number of generator roots = number of parity symbols</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fcr</span></code></dt><dd><p>First consecutive root, index form</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prim</span></code></dt><dd><p>Primitive element, index form</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">iprim</span></code></dt><dd><p>prim-th root of 1, index form</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfpoly</span></code></dt><dd><p>The primitive generator polynominal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gffunc</span></code></dt><dd><p>Function to generate the field, if non-canonical representation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">users</span></code></dt><dd><p>Users of this structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">list</span></code></dt><dd><p>List entry for the rs codec list</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.rs_control">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">rs_control</span></span></span><a class="headerlink" href="#c.rs_control" title="連結到這個定義">¶</a><br /></dt>
<dd><p>rs control structure per instance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct rs_control {
    struct rs_codec *codec;
    uint16_t buffers[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">codec</span></code></dt><dd><p>The codec used for this instance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buffers</span></code></dt><dd><p>Internal scratch buffers used in calls to <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">decode_rs()</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.init_rs">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">init_rs</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">symsize</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">gfpoly</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">fcr</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">prim</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">nroots</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.init_rs" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Create a RS control <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">and</span></code> initialize it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">symsize</span></code></dt><dd><p>the symbol size (number of bits)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">gfpoly</span></code></dt><dd><p>the extended Galois field generator polynomial coefficients,
with the 0th coefficient in the low order bit. The polynomial
must be primitive;</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">fcr</span></code></dt><dd><p>the first consecutive root of the rs code generator polynomial
in index form</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">prim</span></code></dt><dd><p>primitive element to generate polynomial roots</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">nroots</span></code></dt><dd><p>RS code generator polynomial degree (number of roots)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocations use GFP_KERNEL.</p>
</div>
</section>
<section id="public-functions-provided">
<h2>Public Functions Provided<a class="headerlink" href="#public-functions-provided" title="連結到這個標頭">¶</a></h2>
<p>This chapter contains the autogenerated documentation of the
Reed-Solomon functions which are exported.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.free_rs">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">free_rs</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.free_rs" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Free the rs control structure</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rs_control</span> <span class="pre">*rs</span></code></dt><dd><p>The control structure which is not longer used by the
caller</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Free the control structure. If <strong>rs</strong> is the last user of the associated
codec, free the codec as well.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.init_rs_gfp">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">init_rs_gfp</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">symsize</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">gfpoly</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">fcr</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">prim</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">nroots</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.init_rs_gfp" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Create a RS control <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">and</span></code> initialize it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">symsize</span></code></dt><dd><p>the symbol size (number of bits)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">gfpoly</span></code></dt><dd><p>the extended Galois field generator polynomial coefficients,
with the 0th coefficient in the low order bit. The polynomial
must be primitive;</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">fcr</span></code></dt><dd><p>the first consecutive root of the rs code generator polynomial
in index form</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">prim</span></code></dt><dd><p>primitive element to generate polynomial roots</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">nroots</span></code></dt><dd><p>RS code generator polynomial degree (number of roots)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>Memory allocation flags.</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.init_rs_non_canonical">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">init_rs_non_canonical</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">symsize</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">gffunc</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">int</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">fcr</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">prim</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">nroots</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.init_rs_non_canonical" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Allocate rs control struct for fields with non-canonical representation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">symsize</span></code></dt><dd><p>the symbol size (number of bits)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*gffunc)(int)</span></code></dt><dd><p>pointer to function to generate the next field element,
or the multiplicative identity element if given 0.  Used
instead of gfpoly if gfpoly is 0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">fcr</span></code></dt><dd><p>the first consecutive root of the rs code generator polynomial
in index form</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">prim</span></code></dt><dd><p>primitive element to generate polynomial roots</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">nroots</span></code></dt><dd><p>RS code generator polynomial degree (number of roots)</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.encode_rs8">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">encode_rs8</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rsc</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">par</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">invmsk</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.encode_rs8" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Calculate the parity for data values (8bit data width)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rs_control</span> <span class="pre">*rsc</span></code></dt><dd><p>the rs control structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint8_t</span> <span class="pre">*data</span></code></dt><dd><p>data field of a given type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>data length</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*par</span></code></dt><dd><p>parity data, must be initialized by caller (usually all 0)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">invmsk</span></code></dt><dd><p>invert data mask (will be xored on data)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<blockquote>
<div><p>The parity uses a uint16_t data type to enable
symbol size &gt; 8. The calling code must take care of encoding of the
syndrome result for storage itself.</p>
</div></blockquote>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.decode_rs8">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">decode_rs8</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rsc</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">par</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">s</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">no_eras</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">eras_pos</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">invmsk</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">corr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.decode_rs8" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Decode codeword (8bit data width)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rs_control</span> <span class="pre">*rsc</span></code></dt><dd><p>the rs control structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint8_t</span> <span class="pre">*data</span></code></dt><dd><p>data field of a given type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*par</span></code></dt><dd><p>received parity data field</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>data length</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*s</span></code></dt><dd><p>syndrome data field, must be in index form
(if NULL, syndrome is calculated)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">no_eras</span></code></dt><dd><p>number of erasures</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*eras_pos</span></code></dt><dd><p>position of erasures, can be NULL</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">invmsk</span></code></dt><dd><p>invert data mask (will be xored on data, not on parity!)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*corr</span></code></dt><dd><p>buffer to store correction bitmask on eras_pos</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<blockquote>
<div><p>The syndrome and parity uses a uint16_t data type to enable
symbol size &gt; 8. The calling code must take care of decoding of the
syndrome result and the received parity before calling this code.</p>
</div></blockquote>
<p><strong>Note</strong></p>
<dl>
<dt>The rs_control struct <strong>rsc</strong> contains buffers which are used for</dt><dd><p>decoding, so the caller has to ensure that decoder invocations are
serialized.</p>
<p>Returns the number of corrected symbols or -EBADMSG for uncorrectable
errors. The count includes errors in the parity.</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.encode_rs16">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">encode_rs16</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rsc</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">par</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">invmsk</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.encode_rs16" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Calculate the parity for data values (16bit data width)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rs_control</span> <span class="pre">*rsc</span></code></dt><dd><p>the rs control structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*data</span></code></dt><dd><p>data field of a given type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>data length</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*par</span></code></dt><dd><p>parity data, must be initialized by caller (usually all 0)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">invmsk</span></code></dt><dd><p>invert data mask (will be xored on data, not on parity!)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<blockquote>
<div><p>Each field in the data array contains up to symbol size bits of valid data.</p>
</div></blockquote>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.decode_rs16">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">decode_rs16</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.rs_control" title="rs_control"><span class="n"><span class="pre">rs_control</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rsc</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">par</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">s</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">no_eras</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">eras_pos</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">invmsk</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">corr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.decode_rs16" title="連結到這個定義">¶</a><br /></dt>
<dd><p>Decode codeword (16bit data width)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rs_control</span> <span class="pre">*rsc</span></code></dt><dd><p>the rs control structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*data</span></code></dt><dd><p>data field of a given type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*par</span></code></dt><dd><p>received parity data field</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>data length</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*s</span></code></dt><dd><p>syndrome data field, must be in index form
(if NULL, syndrome is calculated)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">no_eras</span></code></dt><dd><p>number of erasures</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*eras_pos</span></code></dt><dd><p>position of erasures, can be NULL</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">invmsk</span></code></dt><dd><p>invert data mask (will be xored on data, not on parity!)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">*corr</span></code></dt><dd><p>buffer to store correction bitmask on eras_pos</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<blockquote>
<div><p>Each field in the data array contains up to symbol size bits of valid data.</p>
</div></blockquote>
<p><strong>Note</strong></p>
<dl>
<dt>The rc_control struct <strong>rsc</strong> contains buffers which are used for</dt><dd><p>decoding, so the caller has to ensure that decoder invocations are
serialized.</p>
<p>Returns the number of corrected symbols or -EBADMSG for uncorrectable
errors. The count includes errors in the parity.</p>
</dd>
</dl>
</div>
</section>
<section id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="連結到這個標頭">¶</a></h2>
<p>The library code for encoding and decoding was written by Phil Karn.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Copyright 2002, Phil Karn, KA9Q
May be used under the terms of the GNU General Public License (GPL)
</pre></div>
</div>
<p>The wrapper functions and interfaces are written by Thomas Gleixner.</p>
<p>Many users have provided bugfixes, improvements and helping hands for
testing. Thanks a lot.</p>
<p>The following people have contributed to this document:</p>
<p>Thomas Gleixner<a class="reference external" href="mailto:tglx&#37;&#52;&#48;kernel&#46;org">tglx<span>&#64;</span>kernel<span>&#46;</span>org</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/core-api/librs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Coresight for Kernel panic and Watchdog reset &#8212; The Linux Kernel  說明文件</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../_static/documentation_options.js?v=0d9984b1"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/trace/coresight/panic.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />
    <link rel="next" title="UltraSoc - HW Assisted Tracing on SoC" href="ultrasoc-smb.html" />
    <link rel="prev" title="Trace Buffer Extension (TRBE)." href="coresight-trbe.html" />

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.18.0-rc2</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">核心 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">子系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tracing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#introduction-to-tracing">Introduction to Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#core-tracing-frameworks">Core Tracing Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#event-tracing-and-analysis">Event Tracing and Analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#hardware-and-performance-tracing">Hardware and Performance Tracing</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../intel_th.html">Intel(R) Trace Hub (TH)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stm.html">System Trace Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sys-t.html">MIPI SyS-T over STP</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">CoreSight - ARM Hardware Trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rv/index.html">Runtime Verification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hisi-ptt.html">HiSilicon PCIe Tune and Trace device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmiotrace.html">In-kernel memory-mapped I/O tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hwlat_detector.html">Hardware Latency Detector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../osnoise-tracer.html">OSNOISE Tracer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../timerlat-tracer.html">Timerlat tracer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#user-space-tracing">User-Space Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/trace/coresight/panic.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="using-coresight-for-kernel-panic-and-watchdog-reset">
<h1>Using Coresight for Kernel panic and Watchdog reset<a class="headerlink" href="#using-coresight-for-kernel-panic-and-watchdog-reset" title="連結到這個標頭">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="連結到這個標頭">¶</a></h2>
<p>This documentation is about using Linux coresight trace support to
debug kernel panic and watchdog reset scenarios.</p>
</section>
<section id="coresight-trace-during-kernel-panic">
<h2>Coresight trace during Kernel panic<a class="headerlink" href="#coresight-trace-during-kernel-panic" title="連結到這個標頭">¶</a></h2>
<p>From the coresight driver point of view, addressing the kernel panic
situation has four main requirements.</p>
<ol class="loweralpha simple">
<li><p>Support for allocation of trace buffer pages from reserved memory area.
Platform can advertise this using a new device tree property added to
relevant coresight nodes.</p></li>
<li><p>Support for stopping coresight blocks at the time of panic</p></li>
<li><p>Saving required metadata in the specified format</p></li>
<li><p>Support for reading trace data captured at the time of panic</p></li>
</ol>
<section id="allocation-of-trace-buffer-pages-from-reserved-ram">
<h3>Allocation of trace buffer pages from reserved RAM<a class="headerlink" href="#allocation-of-trace-buffer-pages-from-reserved-ram" title="連結到這個標頭">¶</a></h3>
<p>A new optional device tree property &quot;memory-region&quot; is added to the
Coresight TMC device nodes, that would give the base address and size of trace
buffer.</p>
<p>Static allocation of trace buffers would ensure that both IOMMU enabled
and disabled cases are handled. Also, platforms that support persistent
RAM will allow users to read trace data in the subsequent boot without
booting the crashdump kernel.</p>
<p>Note:
For ETR sink devices, this reserved region will be used for both trace
capture and trace data retrieval.
For ETF sink devices, internal SRAM would be used for trace capture,
and they would be synced to reserved region for retrieval.</p>
</section>
<section id="disabling-coresight-blocks-at-the-time-of-panic">
<h3>Disabling coresight blocks at the time of panic<a class="headerlink" href="#disabling-coresight-blocks-at-the-time-of-panic" title="連結到這個標頭">¶</a></h3>
<p>In order to avoid the situation of losing relevant trace data after a
kernel panic, it would be desirable to stop the coresight blocks at the
time of panic.</p>
<p>This can be achieved by configuring the comparator, CTI and sink
devices as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>       Trigger on panic
Comparator ---&gt;External out ---&gt;CTI --&gt;External In----&gt;ETR/ETF stop
</pre></div>
</div>
</section>
<section id="saving-metadata-at-the-time-of-kernel-panic">
<h3>Saving metadata at the time of kernel panic<a class="headerlink" href="#saving-metadata-at-the-time-of-kernel-panic" title="連結到這個標頭">¶</a></h3>
<p>Coresight metadata involves all additional data that are required for a
successful trace decode in addition to the trace data. This involves
ETR/ETF/ETB register snapshot etc.</p>
<p>A new optional device property &quot;memory-region&quot; is added to
the ETR/ETF/ETB device nodes for this.</p>
</section>
<section id="reading-trace-data-captured-at-the-time-of-panic">
<h3>Reading trace data captured at the time of panic<a class="headerlink" href="#reading-trace-data-captured-at-the-time-of-panic" title="連結到這個標頭">¶</a></h3>
<p>Trace data captured at the time of panic, can be read from rebooted kernel
or from crashdump kernel using a special device file /dev/crash_tmc_xxx.
This device file is created only when there is a valid crashdata available.</p>
</section>
<section id="general-flow-of-trace-capture-and-decode-in-case-of-kernel-panic">
<h3>General flow of trace capture and decode in case of kernel panic<a class="headerlink" href="#general-flow-of-trace-capture-and-decode-in-case-of-kernel-panic" title="連結到這個標頭">¶</a></h3>
<ol class="arabic">
<li><p>Enable source and sink on all the cores using the sysfs interface.
ETR sinks should have trace buffers allocated from reserved memory,
by selecting &quot;resrv&quot; buffer mode from sysfs.</p></li>
<li><p>Run relevant tests.</p></li>
<li><p>On a kernel panic, all coresight blocks are disabled, necessary
metadata is synced by kernel panic handler.</p>
<p>System would eventually reboot or boot a crashdump kernel.</p>
</li>
<li><p>For  platforms that supports crashdump kernel, raw trace data can be
dumped using the coresight sysfs interface from the crashdump kernel
itself. Persistent RAM is not a requirement in this case.</p></li>
<li><p>For platforms that supports persistent RAM, trace data can be dumped
using the coresight sysfs interface in the subsequent Linux boot.
Crashdump kernel is not a requirement in this case. Persistent RAM
ensures that trace data is intact across reboot.</p></li>
</ol>
</section>
</section>
<section id="coresight-trace-during-watchdog-reset">
<h2>Coresight trace during Watchdog reset<a class="headerlink" href="#coresight-trace-during-watchdog-reset" title="連結到這個標頭">¶</a></h2>
<p>The main difference between addressing the watchdog reset and kernel panic
case are below,</p>
<ol class="loweralpha simple">
<li><p>Saving coresight metadata need to be taken care by the
SCP(system control processor) firmware in the specified format,
instead of kernel.</p></li>
<li><p>Reserved memory region given by firmware for trace buffer and metadata
has to be in persistent RAM.
Note: This is a requirement for watchdog reset case but optional
in kernel panic case.</p></li>
</ol>
<p>Watchdog reset can be supported only on platforms that meet the above
two requirements.</p>
</section>
<section id="sample-commands-for-testing-a-kernel-panic-case-with-etr-sink">
<h2>Sample commands for testing a Kernel panic case with ETR sink<a class="headerlink" href="#sample-commands-for-testing-a-kernel-panic-case-with-etr-sink" title="連結到這個標頭">¶</a></h2>
<ol class="arabic">
<li><p>Boot Linux kernel with &quot;crash_kexec_post_notifiers&quot; added to the kernel
bootargs. This is mandatory if the user would like to read the tracedata
from the crashdump kernel.</p></li>
<li><p>Enable the preloaded ETM configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#echo 1 &gt; /sys/kernel/config/cs-syscfg/configurations/panicstop/enable
</pre></div>
</div>
</li>
<li><p>Configure CTI using sysfs interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#./cti_setup.sh

#cat cti_setup.sh


cd /sys/bus/coresight/devices/

ap_cti_config () {
  #ETM trig out[0] trigger to Channel 0
  echo 0 4 &gt; channels/trigin_attach
}

etf_cti_config () {
  #ETF Flush in trigger from Channel 0
  echo 0 1 &gt; channels/trigout_attach
  echo 1 &gt; channels/trig_filter_enable
}

etr_cti_config () {
  #ETR Flush in from Channel 0
  echo 0 1 &gt; channels/trigout_attach
  echo 1 &gt; channels/trig_filter_enable
}

ctidevs=`find . -name &quot;cti*&quot;`

for i in $ctidevs
do
        cd $i

        connection=`find . -name &quot;ete*&quot;`
        if [ ! -z &quot;$connection&quot; ]
        then
                echo &quot;AP CTI config for $i&quot;
                ap_cti_config
        fi

        connection=`find . -name &quot;tmc_etf*&quot;`
        if [ ! -z &quot;$connection&quot; ]
        then
                echo &quot;ETF CTI config for $i&quot;
                etf_cti_config
        fi

        connection=`find . -name &quot;tmc_etr*&quot;`
        if [ ! -z &quot;$connection&quot; ]
        then
                echo &quot;ETR CTI config for $i&quot;
                etr_cti_config
        fi

        cd ..
done
</pre></div>
</div>
</li>
</ol>
<p>Note: CTI connections are SOC specific and hence the above script is
added just for reference.</p>
<ol class="arabic" start="4">
<li><p>Choose reserved buffer mode for ETR buffer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#echo &quot;resrv&quot; &gt; /sys/bus/coresight/devices/tmc_etr0/buf_mode_preferred
</pre></div>
</div>
</li>
<li><p>Enable stop on flush trigger configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#echo 1 &gt; /sys/bus/coresight/devices/tmc_etr0/stop_on_flush
</pre></div>
</div>
</li>
<li><p>Start Coresight tracing on cores 1 and 2 using sysfs interface</p></li>
<li><p>Run some application on core 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#taskset -c 1 dd if=/dev/urandom of=/dev/null &amp;
</pre></div>
</div>
</li>
<li><p>Invoke kernel panic on core 2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#echo 1 &gt; /proc/sys/kernel/panic
#taskset -c 2 echo c &gt; /proc/sysrq-trigger
</pre></div>
</div>
</li>
<li><p>From rebooted kernel or crashdump kernel, read crashdata:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#dd if=/dev/crash_tmc_etr0 of=/trace/cstrace.bin
</pre></div>
</div>
</li>
<li><p>Run opencsd decoder tools/scripts to generate the instruction trace.</p></li>
</ol>
<section id="sample-instruction-trace-dump">
<h3>Sample instruction trace dump<a class="headerlink" href="#sample-instruction-trace-dump" title="連結到這個標頭">¶</a></h3>
<p>Core1 dump:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>A                                  etm4_enable_hw: ffff800008ae1dd4
CONTEXT EL2                        etm4_enable_hw: ffff800008ae1dd4
I                                  etm4_enable_hw: ffff800008ae1dd4:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1dd8:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1ddc:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1de0:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1de4:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1de8:
d503233f   paciasp
I                                  etm4_enable_hw: ffff800008ae1dec:
a9be7bfd   stp     x29, x30, [sp, #-32]!
I                                  etm4_enable_hw: ffff800008ae1df0:
910003fd   mov     x29, sp
I                                  etm4_enable_hw: ffff800008ae1df4:
a90153f3   stp     x19, x20, [sp, #16]
I                                  etm4_enable_hw: ffff800008ae1df8:
2a0003f4   mov     w20, w0
I                                  etm4_enable_hw: ffff800008ae1dfc:
900085b3   adrp    x19, ffff800009b95000 &lt;reserved_mem+0xc48&gt;
I                                  etm4_enable_hw: ffff800008ae1e00:
910f4273   add     x19, x19, #0x3d0
I                                  etm4_enable_hw: ffff800008ae1e04:
f8747a60   ldr     x0, [x19, x20, lsl #3]
E                                  etm4_enable_hw: ffff800008ae1e08:
b4000140   cbz     x0, ffff800008ae1e30 &lt;etm4_starting_cpu+0x50&gt;
I    149.039572921                 etm4_enable_hw: ffff800008ae1e30:
a94153f3   ldp     x19, x20, [sp, #16]
I    149.039572921                 etm4_enable_hw: ffff800008ae1e34:
52800000   mov     w0, #0x0                        // #0
I    149.039572921                 etm4_enable_hw: ffff800008ae1e38:
a8c27bfd   ldp     x29, x30, [sp], #32

..snip

    149.052324811           chacha_block_generic: ffff800008642d80:
9100a3e0   add     x0,
I    149.052324811           chacha_block_generic: ffff800008642d84:
b86178a2   ldr     w2, [x5, x1, lsl #2]
I    149.052324811           chacha_block_generic: ffff800008642d88:
8b010803   add     x3, x0, x1, lsl #2
I    149.052324811           chacha_block_generic: ffff800008642d8c:
b85fc063   ldur    w3, [x3, #-4]
I    149.052324811           chacha_block_generic: ffff800008642d90:
0b030042   add     w2, w2, w3
I    149.052324811           chacha_block_generic: ffff800008642d94:
b8217882   str     w2, [x4, x1, lsl #2]
I    149.052324811           chacha_block_generic: ffff800008642d98:
91000421   add     x1, x1, #0x1
I    149.052324811           chacha_block_generic: ffff800008642d9c:
f100443f   cmp     x1, #0x11
</pre></div>
</div>
<p>Core 2 dump:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>A                                  etm4_enable_hw: ffff800008ae1dd4
CONTEXT EL2                        etm4_enable_hw: ffff800008ae1dd4
I                                  etm4_enable_hw: ffff800008ae1dd4:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1dd8:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1ddc:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1de0:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1de4:
d503201f   nop
I                                  etm4_enable_hw: ffff800008ae1de8:
d503233f   paciasp
I                                  etm4_enable_hw: ffff800008ae1dec:
a9be7bfd   stp     x29, x30, [sp, #-32]!
I                                  etm4_enable_hw: ffff800008ae1df0:
910003fd   mov     x29, sp
I                                  etm4_enable_hw: ffff800008ae1df4:
a90153f3   stp     x19, x20, [sp, #16]
I                                  etm4_enable_hw: ffff800008ae1df8:
2a0003f4   mov     w20, w0
I                                  etm4_enable_hw: ffff800008ae1dfc:
900085b3   adrp    x19, ffff800009b95000 &lt;reserved_mem+0xc48&gt;
I                                  etm4_enable_hw: ffff800008ae1e00:
910f4273   add     x19, x19, #0x3d0
I                                  etm4_enable_hw: ffff800008ae1e04:
f8747a60   ldr     x0, [x19, x20, lsl #3]
E                                  etm4_enable_hw: ffff800008ae1e08:
b4000140   cbz     x0, ffff800008ae1e30 &lt;etm4_starting_cpu+0x50&gt;
I    149.046243445                 etm4_enable_hw: ffff800008ae1e30:
a94153f3   ldp     x19, x20, [sp, #16]
I    149.046243445                 etm4_enable_hw: ffff800008ae1e34:
52800000   mov     w0, #0x0                        // #0
I    149.046243445                 etm4_enable_hw: ffff800008ae1e38:
a8c27bfd   ldp     x29, x30, [sp], #32
I    149.046243445                 etm4_enable_hw: ffff800008ae1e3c:
d50323bf   autiasp
E    149.046243445                 etm4_enable_hw: ffff800008ae1e40:
d65f03c0   ret
A                                ete_sysreg_write: ffff800008adfa18

..snip

I     149.05422547                          panic: ffff800008096300:
a90363f7   stp     x23, x24, [sp, #48]
I     149.05422547                          panic: ffff800008096304:
6b00003f   cmp     w1, w0
I     149.05422547                          panic: ffff800008096308:
3a411804   ccmn    w0, #0x1, #0x4, ne  // ne = any
N     149.05422547                          panic: ffff80000809630c:
540001e0   b.eq    ffff800008096348 &lt;panic+0xe0&gt;  // b.none
I     149.05422547                          panic: ffff800008096310:
f90023f9   str     x25, [sp, #64]
E     149.05422547                          panic: ffff800008096314:
97fe44ef   bl      ffff8000080276d0 &lt;panic_smp_self_stop&gt;
A                                           panic: ffff80000809634c
I     149.05422547                          panic: ffff80000809634c:
910102d5   add     x21, x22, #0x40
I     149.05422547                          panic: ffff800008096350:
52800020   mov     w0, #0x1                        // #1
E     149.05422547                          panic: ffff800008096354:
94166b8b   bl      ffff800008631180 &lt;bust_spinlocks&gt;
N    149.054225518                 bust_spinlocks: ffff800008631180:
340000c0   cbz     w0, ffff800008631198 &lt;bust_spinlocks+0x18&gt;
I    149.054225518                 bust_spinlocks: ffff800008631184:
f000a321   adrp    x1, ffff800009a98000 &lt;pbufs.0+0xbb8&gt;
I    149.054225518                 bust_spinlocks: ffff800008631188:
b9405c20   ldr     w0, [x1, #92]
I    149.054225518                 bust_spinlocks: ffff80000863118c:
11000400   add     w0, w0, #0x1
I    149.054225518                 bust_spinlocks: ffff800008631190:
b9005c20   str     w0, [x1, #92]
E    149.054225518                 bust_spinlocks: ffff800008631194:
d65f03c0   ret
A                                           panic: ffff800008096358
</pre></div>
</div>
</section>
</section>
<section id="perf-based-testing">
<h2>Perf based testing<a class="headerlink" href="#perf-based-testing" title="連結到這個標頭">¶</a></h2>
<section id="starting-perf-session">
<h3>Starting perf session<a class="headerlink" href="#starting-perf-session" title="連結到這個標頭">¶</a></h3>
<p>ETF:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf record -e cs_etm/panicstop,@tmc_etf1/ -C 1
perf record -e cs_etm/panicstop,@tmc_etf2/ -C 2
</pre></div>
</div>
<p>ETR:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf record -e cs_etm/panicstop,@tmc_etr0/ -C 1,2
</pre></div>
</div>
</section>
<section id="reading-trace-data-after-panic">
<h3>Reading trace data after panic<a class="headerlink" href="#reading-trace-data-after-panic" title="連結到這個標頭">¶</a></h3>
<p>Same sysfs based method explained above can be used to retrieve and
decode the trace data after the reboot on kernel panic.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/trace/coresight/panic.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
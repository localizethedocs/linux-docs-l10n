<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Device Whitelist Controller &#8212; The Linux Kernel unknown version 說明文件</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../_static/documentation_options.js?v=b446b479"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/admin-guide/cgroup-v1/devices.html" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />
    <link rel="next" title="Cgroup Freezer" href="freezer-subsystem.html" />
    <link rel="prev" title="CPUSETS" href="cpusets.html" />

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">核心 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">子系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">即時補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-guides-to-kernel-administration">General guides to kernel administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#booting-the-kernel">Booting the kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tracking-down-and-identifying-problems">Tracking down and identifying problems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#core-kernel-subsystems">Core-kernel subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Control Groups version 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpu-load.html">CPU load</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mm/index.html">記憶體管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#block-layer-and-filesystem-administration">Block-layer and filesystem administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#device-specific-guides">Device-specific guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#workload-analysis">Workload analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#everything-else">Everything else</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/cgroup-v1/devices.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="device-whitelist-controller">
<h1>Device Whitelist Controller<a class="headerlink" href="#device-whitelist-controller" title="連結到這個標頭">¶</a></h1>
<section id="description">
<h2>1. Description<a class="headerlink" href="#description" title="連結到這個標頭">¶</a></h2>
<p>Implement a cgroup to track and enforce open and mknod restrictions
on device files.  A device cgroup associates a device access
whitelist with each cgroup.  A whitelist entry has 4 fields.
'type' is a (all), c (char), or b (block).  'all' means it applies
to all types and all major and minor numbers.  Major and minor are
either an integer or * for all.  Access is a composition of r
(read), w (write), and m (mknod).</p>
<p>The root device cgroup starts with rwm to 'all'.  A child device
cgroup gets a copy of the parent.  Administrators can then remove
devices from the whitelist or add new entries.  A child cgroup can
never receive a device access which is denied by its parent.</p>
</section>
<section id="user-interface">
<h2>2. User Interface<a class="headerlink" href="#user-interface" title="連結到這個標頭">¶</a></h2>
<p>An entry is added using devices.allow, and removed using
devices.deny.  For instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;c 1:3 mr&#39; &gt; /sys/fs/cgroup/1/devices.allow
</pre></div>
</div>
<p>allows cgroup 1 to read and mknod the device usually known as
/dev/null.  Doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo a &gt; /sys/fs/cgroup/1/devices.deny
</pre></div>
</div>
<p>will remove the default 'a <em>:</em> rwm' entry. Doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo a &gt; /sys/fs/cgroup/1/devices.allow
</pre></div>
</div>
<p>will add the 'a <em>:</em> rwm' entry to the whitelist.</p>
</section>
<section id="security">
<h2>3. Security<a class="headerlink" href="#security" title="連結到這個標頭">¶</a></h2>
<p>Any task can move itself between cgroups.  This clearly won't
suffice, but we can decide the best way to adequately restrict
movement as people get some experience with this.  We may just want
to require CAP_SYS_ADMIN, which at least is a separate bit from
CAP_MKNOD.  We may want to just refuse moving to a cgroup which
isn't a descendant of the current one.  Or we may want to use
CAP_MAC_ADMIN, since we really are trying to lock down root.</p>
<p>CAP_SYS_ADMIN is needed to modify the whitelist or move another
task to a new cgroup.  (Again we'll probably want to change that).</p>
<p>A cgroup may not be granted more permissions than the cgroup's
parent has.</p>
</section>
<section id="hierarchy">
<h2>4. Hierarchy<a class="headerlink" href="#hierarchy" title="連結到這個標頭">¶</a></h2>
<p>device cgroups maintain hierarchy by making sure a cgroup never has more
access permissions than its parent.  Every time an entry is written to
a cgroup's devices.deny file, all its children will have that entry removed
from their whitelist and all the locally set whitelist entries will be
re-evaluated.  In case one of the locally set whitelist entries would provide
more access than the cgroup's parent, it'll be removed from the whitelist.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  A
 / \
    B

group        behavior       exceptions
A            allow          &quot;b 8:* rwm&quot;, &quot;c 116:1 rw&quot;
B            deny           &quot;c 1:3 rwm&quot;, &quot;c 116:2 rwm&quot;, &quot;b 3:* rwm&quot;
</pre></div>
</div>
<p>If a device is denied in group A:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c 116:* r&quot; &gt; A/devices.deny
</pre></div>
</div>
<p>it'll propagate down and after revalidating B's entries, the whitelist entry
&quot;c 116:2 rwm&quot; will be removed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>group        whitelist entries                        denied devices
A            all                                      &quot;b 8:* rwm&quot;, &quot;c 116:* rw&quot;
B            &quot;c 1:3 rwm&quot;, &quot;b 3:* rwm&quot;                 all the rest
</pre></div>
</div>
<p>In case parent's exceptions change and local exceptions are not allowed
anymore, they'll be deleted.</p>
<p>Notice that new whitelist entries will not be propagated:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  A
 / \
    B

group        whitelist entries                        denied devices
A            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
B            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
</pre></div>
</div>
<p>when adding <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">*:3</span> <span class="pre">rwm</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c *:3 rwm&quot; &gt;A/devices.allow
</pre></div>
</div>
<p>the result:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>group        whitelist entries                        denied devices
A            &quot;c *:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
B            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
</pre></div>
</div>
<p>but now it'll be possible to add new entries to B:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c 2:3 rwm&quot; &gt;B/devices.allow
# echo &quot;c 50:3 r&quot; &gt;B/devices.allow
</pre></div>
</div>
<p>or even:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c *:3 rwm&quot; &gt;B/devices.allow
</pre></div>
</div>
<p>Allowing or denying all by writing 'a' to devices.allow or devices.deny will
not be possible once the device cgroups has children.</p>
<section id="hierarchy-internal-implementation">
<h3>4.1 Hierarchy (internal implementation)<a class="headerlink" href="#hierarchy-internal-implementation" title="連結到這個標頭">¶</a></h3>
<p>device cgroups is implemented internally using a behavior (ALLOW, DENY) and a
list of exceptions.  The internal state is controlled using the same user
interface to preserve compatibility with the previous whitelist-only
implementation.  Removal or addition of exceptions that will reduce the access
to devices will be propagated down the hierarchy.
For every propagated exception, the effective rules will be re-evaluated based
on current parent's access rules.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/admin-guide/cgroup-v1/devices.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
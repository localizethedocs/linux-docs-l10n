<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>General Information &#8212; The Linux Kernel  說明文件</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=adfc0c0d" />
    <script src="../_static/documentation_options.js?v=0d9984b1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=cbf116e0"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/rust/general-information.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜尋" href="../search.html" />
    <link rel="next" title="Coding Guidelines" href="coding-guidelines.html" />
    <link rel="prev" title="Quick Start" href="quick-start.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.18.0-rc2</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">提交補釘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">行為守則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">維護者手冊</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">核心 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">子系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">撰寫文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">開發工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">測試指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Rust</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#the-rust-experiment">The Rust experiment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code-documentation">Code documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="quick-start.html">Quick Start</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">General Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding-guidelines.html">Coding Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="arch-support.html">Arch Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">建置系統</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">回報議題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">使用者空間工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">使用者空間 API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">韌體</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">韌體與裝置樹</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU 架構</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">未排序的文件</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/rust/general-information.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="general-information">
<h1>General Information<a class="headerlink" href="#general-information" title="連結到這個標頭">¶</a></h1>
<p>This document contains useful information to know when working with
the Rust support in the kernel.</p>
<section id="no-std">
<h2><code class="docutils literal notranslate"><span class="pre">no_std</span></code><a class="headerlink" href="#no-std" title="連結到這個標頭">¶</a></h2>
<p>The Rust support in the kernel can link only <a class="reference external" href="https://doc.rust-lang.org/core/">core</a>,
but not <a class="reference external" href="https://doc.rust-lang.org/std/">std</a>. Crates for use in the
kernel must opt into this behavior using the <code class="docutils literal notranslate"><span class="pre">#![no_std]</span></code> attribute.</p>
</section>
<section id="code-documentation">
<span id="rust-code-documentation"></span><h2>Code documentation<a class="headerlink" href="#code-documentation" title="連結到這個標頭">¶</a></h2>
<p>Rust kernel code is documented using <code class="docutils literal notranslate"><span class="pre">rustdoc</span></code>, its built-in documentation
generator.</p>
<p>The generated HTML docs include integrated search, linked items (e.g. types,
functions, constants), source code, etc. They may be read at:</p>
<blockquote>
<div><p><a class="reference external" href="https://rust.docs.kernel.org">https://rust.docs.kernel.org</a></p>
</div></blockquote>
<p>For linux-next, please see:</p>
<blockquote>
<div><p><a class="reference external" href="https://rust.docs.kernel.org/next/">https://rust.docs.kernel.org/next/</a></p>
</div></blockquote>
<p>There are also tags for each main release, e.g.:</p>
<blockquote>
<div><p><a class="reference external" href="https://rust.docs.kernel.org/6.10/">https://rust.docs.kernel.org/6.10/</a></p>
</div></blockquote>
<p>The docs can also be easily generated and read locally. This is quite fast
(same order as compiling the code itself) and no special tools or environment
are needed. This has the added advantage that they will be tailored to
the particular kernel configuration used. To generate them, use the <code class="docutils literal notranslate"><span class="pre">rustdoc</span></code>
target with the same invocation used for compilation, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make LLVM=1 rustdoc
</pre></div>
</div>
<p>To read the docs locally in your web browser, run e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>xdg-open Documentation/output/rust/rustdoc/kernel/index.html
</pre></div>
</div>
<p>To learn about how to write the documentation, please see <a class="reference internal" href="coding-guidelines.html"><span class="doc">Coding Guidelines</span></a>.</p>
</section>
<section id="extra-lints">
<h2>Extra lints<a class="headerlink" href="#extra-lints" title="連結到這個標頭">¶</a></h2>
<p>While <code class="docutils literal notranslate"><span class="pre">rustc</span></code> is a very helpful compiler, some extra lints and analyses are
available via <code class="docutils literal notranslate"><span class="pre">clippy</span></code>, a Rust linter. To enable it, pass <code class="docutils literal notranslate"><span class="pre">CLIPPY=1</span></code> to
the same invocation used for compilation, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make LLVM=1 CLIPPY=1
</pre></div>
</div>
<p>Please note that Clippy may change code generation, thus it should not be
enabled while building a production kernel.</p>
</section>
<section id="abstractions-vs-bindings">
<h2>Abstractions vs. bindings<a class="headerlink" href="#abstractions-vs-bindings" title="連結到這個標頭">¶</a></h2>
<p>Abstractions are Rust code wrapping kernel functionality from the C side.</p>
<p>In order to use functions and types from the C side, bindings are created.
Bindings are the declarations for Rust of those functions and types from
the C side.</p>
<p>For instance, one may write a <code class="docutils literal notranslate"><span class="pre">Mutex</span></code> abstraction in Rust which wraps
a <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mutex</span></code> from the C side and calls its functions through the bindings.</p>
<p>Abstractions are not available for all the kernel internal APIs and concepts,
but it is intended that coverage is expanded as time goes on. &quot;Leaf&quot; modules
(e.g. drivers) should not use the C bindings directly. Instead, subsystems
should provide as-safe-as-possible abstractions as needed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                                rust/bindings/
                                               (rust/helpers/)

                                                   include/ -----+ &lt;-+
                                                                 |   |
  drivers/              rust/kernel/              +----------+ &lt;-+   |
    fs/                                           | bindgen  |       |
   .../            +-------------------+          +----------+ --+   |
                   |    Abstractions   |                         |   |
+---------+        | +------+ +------+ |          +----------+   |   |
| my_foo  | -----&gt; | | foo  | | bar  | | -------&gt; | Bindings | &lt;-+   |
| driver  |  Safe  | | sub- | | sub- | |  Unsafe  |          |       |
+---------+        | |system| |system| |          | bindings | &lt;-----+
     |             | +------+ +------+ |          |  crate   |       |
     |             |   kernel crate    |          +----------+       |
     |             +-------------------+                             |
     |                                                               |
     +------------------# FORBIDDEN #--------------------------------+
</pre></div>
</div>
<p>The main idea is to encapsulate all direct interaction with the kernel's C APIs
into carefully reviewed and documented abstractions. Then users of these
abstractions cannot introduce undefined behavior (UB) as long as:</p>
<ol class="arabic simple">
<li><p>The abstractions are correct (&quot;sound&quot;).</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">unsafe</span></code> blocks respect the safety contract necessary to call the
operations inside the block. Similarly, any <code class="docutils literal notranslate"><span class="pre">unsafe</span> <span class="pre">impl</span></code>s respect the
safety contract necessary to implement the trait.</p></li>
</ol>
<section id="bindings">
<h3>Bindings<a class="headerlink" href="#bindings" title="連結到這個標頭">¶</a></h3>
<p>By including a C header from <code class="docutils literal notranslate"><span class="pre">include/</span></code> into
<code class="docutils literal notranslate"><span class="pre">rust/bindings/bindings_helper.h</span></code>, the <code class="docutils literal notranslate"><span class="pre">bindgen</span></code> tool will auto-generate the
bindings for the included subsystem. After building, see the <code class="docutils literal notranslate"><span class="pre">*_generated.rs</span></code>
output files in the <code class="docutils literal notranslate"><span class="pre">rust/bindings/</span></code> directory.</p>
<p>For parts of the C header that <code class="docutils literal notranslate"><span class="pre">bindgen</span></code> does not auto generate, e.g. C
<code class="docutils literal notranslate"><span class="pre">inline</span></code> functions or non-trivial macros, it is acceptable to add a small
wrapper function to <code class="docutils literal notranslate"><span class="pre">rust/helpers/</span></code> to make it available for the Rust side as
well.</p>
</section>
<section id="abstractions">
<h3>Abstractions<a class="headerlink" href="#abstractions" title="連結到這個標頭">¶</a></h3>
<p>Abstractions are the layer between the bindings and the in-kernel users. They
are located in <code class="docutils literal notranslate"><span class="pre">rust/kernel/</span></code> and their role is to encapsulate the unsafe
access to the bindings into an as-safe-as-possible API that they expose to their
users. Users of the abstractions include things like drivers or file systems
written in Rust.</p>
<p>Besides the safety aspect, the abstractions are supposed to be &quot;ergonomic&quot;, in
the sense that they turn the C interfaces into &quot;idiomatic&quot; Rust code. Basic
examples are to turn the C resource acquisition and release into Rust
constructors and destructors or C integer error codes into Rust's <code class="docutils literal notranslate"><span class="pre">Result</span></code>s.</p>
</section>
</section>
<section id="conditional-compilation">
<h2>Conditional compilation<a class="headerlink" href="#conditional-compilation" title="連結到這個標頭">¶</a></h2>
<p>Rust code has access to conditional compilation based on the kernel
configuration:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[cfg(CONFIG_X)]</span><span class="w">       </span><span class="c1">// Enabled               (`y` or `m`)</span>
<span class="cp">#[cfg(CONFIG_X=</span><span class="s">&quot;y&quot;</span><span class="cp">)]</span><span class="w">   </span><span class="c1">// Enabled as a built-in (`y`)</span>
<span class="cp">#[cfg(CONFIG_X=</span><span class="s">&quot;m&quot;</span><span class="cp">)]</span><span class="w">   </span><span class="c1">// Enabled as a module   (`m`)</span>
<span class="cp">#[cfg(not(CONFIG_X))]</span><span class="w">  </span><span class="c1">// Disabled</span>
</pre></div>
</div>
<p>For other predicates that Rust's <code class="docutils literal notranslate"><span class="pre">cfg</span></code> does not support, e.g. expressions with
numerical comparisons, one may define a new Kconfig symbol:</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="k">config</span><span class="w"> </span>RUSTC_VERSION_MIN_107900
<span class="w">        </span>def_bool<span class="w"> </span>y<span class="w"> </span><span class="k">if</span><span class="w"> </span>RUSTC_VERSION<span class="w"> </span>&gt;=<span class="w"> </span><span class="mi">107900</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/rust/general-information.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
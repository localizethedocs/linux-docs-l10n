<!DOCTYPE html>

<html lang="en-US" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Live Update uAPI &#8212; The Linux Kernel unknown version documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=adfc0c0d" />
    <script src="../_static/documentation_options.js?v=750ed68d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/userspace-api/liveupdate.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Netlink Handbook" href="netlink/index.html" />
    <link rel="prev" title="Linux-specific ELF idiosyncrasies" href="ELF.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Userspace API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#system-calls">System calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#security-related-interfaces">Security-related interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#devices-and-i-o">Devices and I/O</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#everything-else">Everything else</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ELF.html">Linux-specific ELF idiosyncrasies</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Live Update uAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="netlink/index.html">Netlink Handbook</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysfs-platform_profile.html">Platform Profile Selection (e.g. /sys/firmware/acpi/platform_profile)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vduse.html">VDUSE - “vDPA Device in Userspace”</a></li>
<li class="toctree-l3"><a class="reference internal" href="futex2.html">futex2</a></li>
<li class="toctree-l3"><a class="reference internal" href="perf_ring_buffer.html">Perf ring buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntsync.html">NT synchronization primitive driver</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userspace-api/liveupdate.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="live-update-uapi">
<h1>Live Update uAPI<a class="headerlink" href="#live-update-uapi" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Pasha Tatashin &lt;<a class="reference external" href="mailto:pasha&#46;tatashin&#37;&#52;&#48;soleen&#46;com">pasha<span>&#46;</span>tatashin<span>&#64;</span>soleen<span>&#46;</span>com</a>&gt;</p>
</dd>
</dl>
<section id="ioctl-interface">
<h2>ioctl interface<a class="headerlink" href="#ioctl-interface" title="Link to this heading">¶</a></h2>
<p>The IOCTL user-space control interface for the LUO subsystem.
It registers a character device, typically found at <code class="docutils literal notranslate"><span class="pre">/dev/liveupdate</span></code>,
which allows a userspace agent to manage the LUO state machine and its
associated resources, such as preservable file descriptors.</p>
<p>To ensure that the state machine is controlled by a single entity, access
to this device is exclusive: only one process is permitted to have
<code class="docutils literal notranslate"><span class="pre">/dev/liveupdate</span></code> open at any given time. Subsequent open attempts will
fail with -EBUSY until the first process closes its file descriptor.
This singleton model simplifies state management by preventing conflicting
commands from multiple userspace agents.</p>
</section>
<section id="ioctl-uapi">
<h2>ioctl uAPI<a class="headerlink" href="#ioctl-uapi" title="Link to this heading">¶</a></h2>
<p id="general-ioctl-format"><strong>General ioctl format</strong></p>
<p>The ioctl interface follows a general format to allow for extensibility. Each
ioctl is passed in a structure pointer as the argument providing the size of
the structure in the first u32. The kernel checks that any structure space
beyond what it understands is 0. This allows userspace to use the backward
compatible portion while consistently using the newer, larger, structures.</p>
<p>ioctls use a standard meaning for common errnos:</p>
<blockquote>
<div><ul class="simple">
<li><p>ENOTTY: The IOCTL number itself is not supported at all</p></li>
<li><p>E2BIG: The IOCTL number is supported, but the provided structure has
non-zero in a part the kernel does not understand.</p></li>
<li><p>EOPNOTSUPP: The IOCTL number is supported, and the structure is
understood, however a known field has a value the kernel does not
understand or support.</p></li>
<li><p>EINVAL: Everything about the IOCTL was understood, but a field is not
correct.</p></li>
<li><p>ENOENT: A provided token does not exist.</p></li>
<li><p>ENOMEM: Out of memory.</p></li>
<li><p>EOVERFLOW: Mathematics overflowed.</p></li>
</ul>
</div></blockquote>
<p>As well as additional errnos, within specific ioctls.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.liveupdate_ioctl_create_session">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">liveupdate_ioctl_create_session</span></span></span><a class="headerlink" href="#c.liveupdate_ioctl_create_session" title="Link to this definition">¶</a><br /></dt>
<dd><p>ioctl(LIVEUPDATE_IOCTL_CREATE_SESSION)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct liveupdate_ioctl_create_session {
    __u32 size;
    __s32 fd;
    __u8 name[LIVEUPDATE_SESSION_NAME_LENGTH];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Input; sizeof(<a class="reference internal" href="#c.liveupdate_ioctl_create_session" title="liveupdate_ioctl_create_session"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">liveupdate_ioctl_create_session</span></code></a>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fd</span></code></dt><dd><p>Output; The new file descriptor for the created session.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Input; A null-terminated string for the session name, max
length <code class="docutils literal notranslate"><span class="pre">LIVEUPDATE_SESSION_NAME_LENGTH</span></code> including termination
character.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Creates a new live update session for managing preserved resources.
This ioctl can only be called on the main /dev/liveupdate device.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code on failure.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.liveupdate_ioctl_retrieve_session">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">liveupdate_ioctl_retrieve_session</span></span></span><a class="headerlink" href="#c.liveupdate_ioctl_retrieve_session" title="Link to this definition">¶</a><br /></dt>
<dd><p>ioctl(LIVEUPDATE_IOCTL_RETRIEVE_SESSION)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct liveupdate_ioctl_retrieve_session {
    __u32 size;
    __s32 fd;
    __u8 name[LIVEUPDATE_SESSION_NAME_LENGTH];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Input; sizeof(<a class="reference internal" href="#c.liveupdate_ioctl_retrieve_session" title="liveupdate_ioctl_retrieve_session"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">liveupdate_ioctl_retrieve_session</span></code></a>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fd</span></code></dt><dd><p>Output; The new file descriptor for the retrieved session.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Input; A null-terminated string identifying the session to retrieve.
The name must exactly match the name used when the session was
created in the previous kernel.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Retrieves a handle (a new file descriptor) for a preserved session by its
name. This is the primary mechanism for a userspace agent to regain control
of its preserved resources after a live update.</p>
<p>The userspace application provides the null-terminated <cite>name</cite> of a session
it created before the live update. If a preserved session with a matching
name is found, the kernel instantiates it and returns a new file descriptor
in the <cite>fd</cite> field. This new session FD can then be used for all file-specific
operations, such as restoring individual file descriptors with
LIVEUPDATE_SESSION_RETRIEVE_FD.</p>
<p>It is the responsibility of the userspace application to know the names of
the sessions it needs to retrieve. If no session with the given name is
found, the ioctl will fail with -ENOENT.</p>
<p>This ioctl can only be called on the main /dev/liveupdate device when the
system is in the LIVEUPDATE_STATE_UPDATED state.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.liveupdate_session_preserve_fd">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">liveupdate_session_preserve_fd</span></span></span><a class="headerlink" href="#c.liveupdate_session_preserve_fd" title="Link to this definition">¶</a><br /></dt>
<dd><p>ioctl(LIVEUPDATE_SESSION_PRESERVE_FD)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct liveupdate_session_preserve_fd {
    __u32 size;
    __s32 fd;
    __aligned_u64 token;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Input; sizeof(<a class="reference internal" href="#c.liveupdate_session_preserve_fd" title="liveupdate_session_preserve_fd"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">liveupdate_session_preserve_fd</span></code></a>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fd</span></code></dt><dd><p>Input; The user-space file descriptor to be preserved.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">token</span></code></dt><dd><p>Input; An opaque, unique token for preserved resource.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Holds parameters for preserving a file descriptor.</p>
<p>User sets the <strong>fd</strong> field identifying the file descriptor to preserve
(e.g., memfd, kvm, iommufd, VFIO). The kernel validates if this FD type
and its dependencies are supported for preservation. If validation passes,
the kernel marks the FD internally and <em>initiates the process</em> of preparing
its state for saving. The actual snapshotting of the state typically occurs
during the subsequent <code class="docutils literal notranslate"><span class="pre">LIVEUPDATE_IOCTL_PREPARE</span></code> execution phase, though
some finalization might occur during freeze.
On successful validation and initiation, the kernel uses the <strong>token</strong>
field with an opaque identifier representing the resource being preserved.
This token confirms the FD is targeted for preservation and is required for
the subsequent <code class="docutils literal notranslate"><span class="pre">LIVEUPDATE_SESSION_RETRIEVE_FD</span></code> call after the live update.</p>
<p><strong>Return</strong></p>
<p>0 on success (validation passed, preservation initiated), negative
error code on failure (e.g., unsupported FD type, dependency issue,
validation failed).</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.liveupdate_session_retrieve_fd">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">liveupdate_session_retrieve_fd</span></span></span><a class="headerlink" href="#c.liveupdate_session_retrieve_fd" title="Link to this definition">¶</a><br /></dt>
<dd><p>ioctl(LIVEUPDATE_SESSION_RETRIEVE_FD)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct liveupdate_session_retrieve_fd {
    __u32 size;
    __s32 fd;
    __aligned_u64 token;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Input; sizeof(<a class="reference internal" href="#c.liveupdate_session_retrieve_fd" title="liveupdate_session_retrieve_fd"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">liveupdate_session_retrieve_fd</span></code></a>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fd</span></code></dt><dd><p>Output; The new file descriptor representing the fully restored
kernel resource.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">token</span></code></dt><dd><p>Input; An opaque, token that was used to preserve the resource.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Retrieve a previously preserved file descriptor.</p>
<p>User sets the <strong>token</strong> field to the value obtained from a successful
<code class="docutils literal notranslate"><span class="pre">LIVEUPDATE_IOCTL_FD_PRESERVE</span></code> call before the live update. On success,
the kernel restores the state (saved during the PREPARE/FREEZE phases)
associated with the token and populates the <strong>fd</strong> field with a new file
descriptor referencing the restored resource in the current (new) kernel.
This operation must be performed <em>before</em> signaling completion via
<code class="docutils literal notranslate"><span class="pre">LIVEUPDATE_IOCTL_FINISH</span></code>.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code on failure (e.g., invalid token).</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.liveupdate_session_finish">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">liveupdate_session_finish</span></span></span><a class="headerlink" href="#c.liveupdate_session_finish" title="Link to this definition">¶</a><br /></dt>
<dd><p>ioctl(LIVEUPDATE_SESSION_FINISH)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct liveupdate_session_finish {
    __u32 size;
    __u32 reserved;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Input; sizeof(<a class="reference internal" href="#c.liveupdate_session_finish" title="liveupdate_session_finish"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">liveupdate_session_finish</span></code></a>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>Input; Must be zero. Reserved for future use.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Signals the completion of the restoration process for a retrieved session.
This is the final operation that should be performed on a session file
descriptor after a live update.</p>
<p>This ioctl must be called once all required file descriptors for the session
have been successfully retrieved (using <code class="docutils literal notranslate"><span class="pre">LIVEUPDATE_SESSION_RETRIEVE_FD</span></code>) and
are fully restored from the userspace and kernel perspective.</p>
<p>Upon success, the kernel releases its ownership of the preserved resources
associated with this session. This allows internal resources to be freed,
typically by decrementing reference counts on the underlying preserved
objects.</p>
<p>If this operation fails, the resources remain preserved in memory. Userspace
may attempt to call finish again. The resources will otherwise be reset
during the next live update cycle.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code on failure.</p>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../core-api/liveupdate.html"><span class="doc">Live Update Orchestrator</span></a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/userspace-api/liveupdate.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
<!DOCTYPE html>

<html lang="en-US" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FWSEC (Firmware Security) &#8212; The Linux Kernel unknown version documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../../_static/documentation_options.js?v=750ed68d"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/gpu/nova/core/fwsec.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Falcon (FAst Logic Controller)" href="falcon.html" />
    <link rel="prev" title="Device Initialization (devinit)" href="devinit.html" />

   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../subsystem-apis.html#human-interfaces">Human interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../input/index.html">Input Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sound/index.html">Sound Subsystem Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">GPU Driver Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#other-subsystems">Other subsystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/gpu/nova/core/fwsec.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="fwsec-firmware-security">
<h1>FWSEC (Firmware Security)<a class="headerlink" href="#fwsec-firmware-security" title="Link to this heading">¶</a></h1>
<p>This document briefly/conceptually describes the FWSEC (Firmware Security) image
and its role in the GPU boot sequence. As such, this information is subject to
change in the future and is only current as of the Ampere GPU family. However,
hopefully the concepts described will be useful for understanding the kernel code
that deals with it. All the information is derived from publicly available
sources such as public drivers and documentation.</p>
<p>The role of FWSEC is to provide a secure boot process. It runs in
‘Heavy-secure’ mode, and performs firmware verification after a GPU reset
before loading various ucode images onto other microcontrollers on the GPU,
such as the PMU and GSP.</p>
<p>FWSEC itself is an application stored in the VBIOS ROM in the FWSEC partition of
ROM (see <a class="reference internal" href="vbios.html"><span class="doc">VBIOS</span></a> for more details). It contains different commands like FRTS
(Firmware Runtime Services) and SB (Secure Booting other microcontrollers after
reset and loading them with other non-FWSEC ucode). The kernel driver only needs
to perform FRTS, since Secure Boot (SB) has already completed by the time the driver
is loaded.</p>
<p>The FRTS command carves out the WPR2 region (Write protected region) which contains
data required for power management. Once setup, only HS mode ucode can access it
(see <a class="reference internal" href="falcon.html"><span class="doc">Falcon (FAst Logic Controller)</span></a> for privilege levels).</p>
<p>The FWSEC image is located in the VBIOS ROM in the partition of the ROM that contains
various ucode images (also known as applications) -- one of them being FWSEC. For how
it is extracted, see <a class="reference internal" href="vbios.html"><span class="doc">VBIOS</span></a> and the vbios.rs source code.</p>
<p>The Falcon data for each ucode images (including the FWSEC image) is a combination
of headers, data sections (DMEM) and instruction code sections (IMEM). All these
ucode images are stored in the same ROM partition and the PMU table is used to look
up the application to load it based on its application ID (see vbios.rs).</p>
<p>For the nova-core driver, the FWSEC contains an ‘application interface’ called
DMEMMAPPER. This interface is used to execute the ‘FWSEC-FRTS’ command, among others.
For Ampere, FWSEC is running on the GSP in Heavy-secure mode and runs FRTS.</p>
<section id="fwsec-memory-layout">
<h2>FWSEC Memory Layout<a class="headerlink" href="#fwsec-memory-layout" title="Link to this heading">¶</a></h2>
<p>The memory layout of the FWSEC image is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+---------------------------------------------------------------+
|                         FWSEC ROM image (type 0xE0)           |
|                                                               |
|  +---------------------------------+                          |
|  |     PMU Falcon Ucode Table      |                          |
|  |     (PmuLookupTable)            |                          |
|  |  +-------------------------+    |                          |
|  |  | Table Header            |    |                          |
|  |  | - version: 0x01         |    |                          |
|  |  | - header_size: 6        |    |                          |
|  |  | - entry_size: 6         |    |                          |
|  |  | - entry_count: N        |    |                          |
|  |  | - desc_version:3(unused)|    |                          |
|  |  +-------------------------+    |                          |
|  |         ...                     |                          |
|  |  +-------------------------+    |                          |
|  |  | Entry for FWSEC (0x85)  |    |                          |
|  |  | (PmuLookupTableEntry)   |    |                          |
|  |  | - app_id: 0x85 (FWSEC)  |----|----+                     |
|  |  | - target_id: 0x01 (PMU) |    |    |                     |
|  |  | - data: offset ---------|----|----|---+ look up FWSEC   |
|  |  +-------------------------+    |    |   |                 |
|  +---------------------------------+    |   |                 |
|                                         |   |                 |
|                                         |   |                 |
|  +---------------------------------+    |   |                 |
|  |     FWSEC Ucode Component       |&lt;---+   |                 |
|  |     (aka Falcon data)           |        |                 |
|  |  +-------------------------+    |        |                 |
|  |  | FalconUCodeDescV3       |&lt;---|--------+                 |
|  |  | - hdr                   |    |                          |
|  |  | - stored_size           |    |                          |
|  |  | - pkc_data_offset       |    |                          |
|  |  | - interface_offset -----|----|----------------+         |
|  |  | - imem_phys_base        |    |                |         |
|  |  | - imem_load_size        |    |                |         |
|  |  | - imem_virt_base        |    |                |         |
|  |  | - dmem_phys_base        |    |                |         |
|  |  | - dmem_load_size        |    |                |         |
|  |  | - engine_id_mask        |    |                |         |
|  |  | - ucode_id              |    |                |         |
|  |  | - signature_count       |    |    look up sig |         |
|  |  | - signature_versions --------------+          |         |
|  |  +-------------------------+    |     |          |         |
|  |         (no gap)                |     |          |         |
|  |  +-------------------------+    |     |          |         |
|  |  | Signatures Section      |&lt;---|-----+          |         |
|  |  | (384 bytes per sig)     |    |                |         |
|  |  | - RSA-3K Signature 1    |    |                |         |
|  |  | - RSA-3K Signature 2    |    |                |         |
|  |  |   ...                   |    |                |         |
|  |  +-------------------------+    |                |         |
|  |                                 |                |         |
|  |  +-------------------------+    |                |         |
|  |  | IMEM Section (Code)     |    |                |         |
|  |  |                         |    |                |         |
|  |  | Contains instruction    |    |                |         |
|  |  | code etc.               |    |                |         |
|  |  +-------------------------+    |                |         |
|  |                                 |                |         |
|  |  +-------------------------+    |                |         |
|  |  | DMEM Section (Data)     |    |                |         |
|  |  |                         |    |                |         |
|  |  | +---------------------+ |    |                |         |
|  |  | | Application         | |&lt;---|----------------+         |
|  |  | | Interface Table     | |    |                          |
|  |  | | (FalconAppifHdrV1)  | |    |                          |
|  |  | | Header:             | |    |                          |
|  |  | | - version: 0x01     | |    |                          |
|  |  | | - header_size: 4    | |    |                          |
|  |  | | - entry_size: 8     | |    |                          |
|  |  | | - entry_count: N    | |    |                          |
|  |  | |                     | |    |                          |
|  |  | | Entries:            | |    |                          |
|  |  | | +-----------------+ | |    |                          |
|  |  | | | DEVINIT (ID 1)  | | |    |                          |
|  |  | | | - id: 0x01      | | |    |                          |
|  |  | | | - dmemOffset X -|-|-|----+                          |
|  |  | | +-----------------+ | |    |                          |
|  |  | | +-----------------+ | |    |                          |
|  |  | | | DMEMMAPPER(ID 4)| | |    |                          |
|  |  | | | - id: 0x04      | | |    | Used only for DevInit    |
|  |  | | |  (NVFW_FALCON_  | | |    | application (not FWSEC)  |
|  |  | | |   APPIF_ID_DMEMMAPPER)   |                          |
|  |  | | | - dmemOffset Y -|-|-|----|-----+                    |
|  |  | | +-----------------+ | |    |     |                    |
|  |  | +---------------------+ |    |     |                    |
|  |  |                         |    |     |                    |
|  |  | +---------------------+ |    |     |                    |
|  |  | | DEVINIT Engine      |&lt;|----+     | Used by FWSEC      |
|  |  | | Interface           | |    |     |         app.       |
|  |  | +---------------------+ |    |     |                    |
|  |  |                         |    |     |                    |
|  |  | +---------------------+ |    |     |                    |
|  |  | | DMEM Mapper (ID 4)  |&lt;|----+-----+                    |
|  |  | | (FalconAppifDmemmapperV3)  |                          |
|  |  | | - signature: &quot;DMAP&quot; | |    |                          |
|  |  | | - version: 0x0003   | |    |                          |
|  |  | | - Size: 64 bytes    | |    |                          |
|  |  | | - cmd_in_buffer_off | |----|------------+             |
|  |  | | - cmd_in_buffer_size| |    |            |             |
|  |  | | - cmd_out_buffer_off| |----|------------|-----+       |
|  |  | | - cmd_out_buffer_sz | |    |            |     |       |
|  |  | | - init_cmd          | |    |            |     |       |
|  |  | | - features          | |    |            |     |       |
|  |  | | - cmd_mask0/1       | |    |            |     |       |
|  |  | +---------------------+ |    |            |     |       |
|  |  |                         |    |            |     |       |
|  |  | +---------------------+ |    |            |     |       |
|  |  | | Command Input Buffer|&lt;|----|------------+     |       |
|  |  | | - Command data      | |    |                  |       |
|  |  | | - Arguments         | |    |                  |       |
|  |  | +---------------------+ |    |                  |       |
|  |  |                         |    |                  |       |
|  |  | +---------------------+ |    |                  |       |
|  |  | | Command Output      |&lt;|----|------------------+       |
|  |  | | Buffer              | |    |                          |
|  |  | | - Results           | |    |                          |
|  |  | | - Status            | |    |                          |
|  |  | +---------------------+ |    |                          |
|  |  +-------------------------+    |                          |
|  +---------------------------------+                          |
|                                                               |
+---------------------------------------------------------------+
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is using an GA-102 Ampere GPU as an example and could vary for future GPUs.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The FWSEC image also plays a role in memory scrubbing (ECC initialization) and VPR
(Video Protected Region) initialization as well. Before the nova-core driver is even
loaded, the FWSEC image is running on the GSP in heavy-secure mode. After the devinit
sequence completes, it does VRAM memory scrubbing (ECC initialization). On consumer
GPUs, it scrubs only part of memory and then initiates ‘async scrubbing’. Before this
async scrubbing completes, the unscrubbed VRAM cannot be used for allocation (thus DRM
memory allocators need to wait for this scrubbing to complete).</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/gpu/nova/core/fwsec.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
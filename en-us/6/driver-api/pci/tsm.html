<!DOCTYPE html>

<html lang="en-US" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PCI Trusted Execution Environment Security Manager (TSM) &#8212; The Linux Kernel unknown version documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../_static/documentation_options.js?v=750ed68d"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/driver-api/pci/tsm.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The Linux RapidIO Subsystem" href="../rapidio/index.html" />
    <link rel="prev" title="PCI Peer-to-Peer DMA Support" href="p2pdma.html" />

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#bus-level-documentation">Bus-level documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cxl/index.html">Compute Express Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eisa.html">EISA bus support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../isa.html">ISA Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">The Linux PCI driver implementer’s API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usb/index.html">Linux USB API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virtio/index.html">Virtio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vme.html">VME Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../w1.html">W1: Dallas’ 1-wire bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#subsystem-specific-apis">Subsystem-specific APIs</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../subsystem-apis.html#core-subsystems">Core subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Driver implementer’s API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mm/index.html">Memory Management Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../timers/index.html">Timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#other-subsystems">Other subsystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/pci/tsm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pci-trusted-execution-environment-security-manager-tsm">
<h1>PCI Trusted Execution Environment Security Manager (TSM)<a class="headerlink" href="#pci-trusted-execution-environment-security-manager-tsm" title="Link to this heading">¶</a></h1>
<section id="subsystem-interfaces">
<h2>Subsystem Interfaces<a class="headerlink" href="#subsystem-interfaces" title="Link to this heading">¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.pci_ide_partner">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_partner</span></span></span><a class="headerlink" href="#c.pci_ide_partner" title="Link to this definition">¶</a><br /></dt>
<dd><p>Per port pair Selective IDE Stream settings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pci_ide_partner {
    u16 rid_start;
    u16 rid_end;
    u8 stream_index;
    struct pci_bus_region mem_assoc;
    struct pci_bus_region pref_assoc;
    unsigned int default_stream:1;
    unsigned int setup:1;
    unsigned int enable:1;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">rid_start</span></code></dt><dd><p>Partner Port Requester ID range start</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rid_end</span></code></dt><dd><p>Partner Port Requester ID range end (inclusive)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stream_index</span></code></dt><dd><p>Selective IDE Stream Register Block selection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mem_assoc</span></code></dt><dd><p>PCI bus memory address association for targeting peer partner</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pref_assoc</span></code></dt><dd><p>PCI bus prefetchable memory address association for
targeting peer partner</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">default_stream</span></code></dt><dd><p>Endpoint uses this stream for all upstream TLPs regardless of
address and RID association registers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">setup</span></code></dt><dd><p>flag to track whether to run <a class="reference internal" href="#c.pci_ide_stream_teardown" title="pci_ide_stream_teardown"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_teardown()</span></code></a> for this
partner slot</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enable</span></code></dt><dd><p>flag whether to run <a class="reference internal" href="#c.pci_ide_stream_disable" title="pci_ide_stream_disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_disable()</span></code></a> for this partner slot</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>By default, <a class="reference internal" href="#c.pci_ide_stream_alloc" title="pci_ide_stream_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_alloc()</span></code></a> initializes <strong>mem_assoc</strong> and <strong>pref_assoc</strong>
with the immediate ancestor downstream port memory ranges (i.e. Type 1
Configuration Space Header values). Caller may zero size ({0, -1}) the range
to drop it from consideration at <a class="reference internal" href="#c.pci_ide_stream_setup" title="pci_ide_stream_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_setup()</span></code></a> time.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.pci_ide_regs">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_regs</span></span></span><a class="headerlink" href="#c.pci_ide_regs" title="Link to this definition">¶</a><br /></dt>
<dd><p>Hardware register association settings for Selective IDE Streams</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pci_ide_regs {
    u32 rid1;
    u32 rid2;
    struct {
        u32 assoc1;
        u32 assoc2;
        u32 assoc3;
    } addr[2];
    int nr_addr;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">rid1</span></code></dt><dd><p>IDE RID Association Register 1</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rid2</span></code></dt><dd><p>IDE RID Association Register 2</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">addr</span></code></dt><dd><p>Up to two address association blocks (IDE Address Association Register
1 through 3) for MMIO and prefetchable MMIO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nr_addr</span></code></dt><dd><p>Number of address association blocks initialized</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>See <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pci_ide_stream_to_regs()</span></code></p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.pci_ide">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide</span></span></span><a class="headerlink" href="#c.pci_ide" title="Link to this definition">¶</a><br /></dt>
<dd><p>PCIe Selective IDE Stream descriptor</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pci_ide {
    struct pci_dev *pdev;
    struct pci_ide_partner partner[PCI_IDE_PARTNER_MAX];
    u8 host_bridge_stream;
    int stream_id;
    const char *name;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pdev</span></code></dt><dd><p>PCIe Endpoint in the pci_ide_partner pair</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">partner</span></code></dt><dd><p>per-partner settings</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">host_bridge_stream</span></code></dt><dd><p>allocated from host bridge <strong>ide_stream_ida</strong> pool</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stream_id</span></code></dt><dd><p>unique Stream ID (within Partner Port pairing)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>name of the established Selective IDE Stream in sysfs</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Negative <strong>stream_id</strong> values indicate “uninitialized” on the
expectation that with TSM established IDE the TSM owns the stream_id
allocation.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_alloc">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_alloc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_alloc" title="Link to this definition">¶</a><br /></dt>
<dd><p>Reserve stream indices and probe for settings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>IDE capable PCIe Endpoint Physical Function</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Retrieve the Requester ID range of <strong>pdev</strong> for programming its Root
Port IDE RID Association registers, and conversely retrieve the
Requester ID of the Root Port for programming <strong>pdev</strong>’s IDE RID
Association registers.</p>
<p>Allocate a Selective IDE Stream Register Block instance per port.</p>
<p>Allocate a platform stream resource from the associated host bridge.
Retrieve stream association parameters for Requester ID range and
address range restrictions for the stream.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_free">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_free</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_free" title="Link to this definition">¶</a><br /></dt>
<dd><p>unwind <a class="reference internal" href="#c.pci_ide_stream_alloc" title="pci_ide_stream_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_alloc()</span></code></a></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>idle IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Free all of the stream index (register block) allocations acquired by
<a class="reference internal" href="#c.pci_ide_stream_alloc" title="pci_ide_stream_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_alloc()</span></code></a>. The stream represented by <strong>ide</strong> is assumed to
be unregistered and not instantiated in any device.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_release">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_release</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_release" title="Link to this definition">¶</a><br /></dt>
<dd><p>unwind and release an <strong>ide</strong> context</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>partially or fully registered IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>In support of automatic cleanup of IDE setup routines perform IDE
teardown in expected reverse order of setup and with respect to which
aspects of IDE setup have successfully completed.</p>
<p>Be careful that setup order mirrors this shutdown order. Otherwise,
open code releasing the IDE context.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_register">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_register</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_register" title="Link to this definition">¶</a><br /></dt>
<dd><p>Prepare to activate an IDE Stream</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>After a Stream ID has been acquired for <strong>ide</strong>, record the presence of
the stream in sysfs. The expectation is that <strong>ide</strong> is immutable while
registered.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_unregister">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_unregister</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_unregister" title="Link to this definition">¶</a><br /></dt>
<dd><p>unwind <a class="reference internal" href="#c.pci_ide_stream_register" title="pci_ide_stream_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_register()</span></code></a></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>idle IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>In preparation for freeing <strong>ide</strong>, remove sysfs enumeration for the
stream.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_setup">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_setup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_setup" title="Link to this definition">¶</a><br /></dt>
<dd><p>program settings to Selective IDE Stream registers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>PCIe device object for either a Root Port or Endpoint Partner Port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>registered IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>When <strong>pdev</strong> is a PCI_EXP_TYPE_ENDPOINT then the PCI_IDE_EP partner
settings are written to <strong>pdev</strong>’s Selective IDE Stream register block,
and when <strong>pdev</strong> is a PCI_EXP_TYPE_ROOT_PORT, the PCI_IDE_RP settings
are selected.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_teardown">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_teardown</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_teardown" title="Link to this definition">¶</a><br /></dt>
<dd><p>disable the stream and clear all settings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>PCIe device object for either a Root Port or Endpoint Partner Port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>registered IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>For stream destruction, zero all registers that may have been written
by <a class="reference internal" href="#c.pci_ide_stream_setup" title="pci_ide_stream_setup"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_setup()</span></code></a>. Consider <a class="reference internal" href="#c.pci_ide_stream_disable" title="pci_ide_stream_disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_disable()</span></code></a> to leave
settings in place while temporarily disabling the stream.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_enable">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_enable</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_enable" title="Link to this definition">¶</a><br /></dt>
<dd><p>enable a Selective IDE Stream</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>PCIe device object for either a Root Port or Endpoint Partner Port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>registered and setup IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Activate the stream by writing to the Selective IDE Stream Control
Register.</p>
<p>Note that the state may go “insecure” at any point after returning 0, but
those events are equivalent to a “link down” event and handled via
asynchronous error reporting.</p>
<p>Caller is responsible to clear the enable bit in the -ENXIO case.</p>
<p><strong>Return</strong></p>
<p>0 if the stream successfully entered the “secure” state, and -EINVAL
if <strong>ide</strong> is invalid, and -ENXIO if the stream fails to enter the secure state.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_stream_disable">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_stream_disable</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_ide" title="pci_ide"><span class="n"><span class="pre">pci_ide</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ide</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_stream_disable" title="Link to this definition">¶</a><br /></dt>
<dd><p>disable a Selective IDE Stream</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>PCIe device object for either a Root Port or Endpoint Partner Port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_ide</span> <span class="pre">*ide</span></code></dt><dd><p>registered and setup IDE settings descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Clear the Selective IDE Stream Control Register, but leave all other
registers untouched.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_ide_set_nr_streams">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_ide_set_nr_streams</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_host_bridge</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hb</span></span>, <span class="n"><span class="pre">u16</span></span><span class="w"> </span><span class="n"><span class="pre">nr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_ide_set_nr_streams" title="Link to this definition">¶</a><br /></dt>
<dd><p>sets size of the pool of IDE Stream resources</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_host_bridge</span> <span class="pre">*hb</span></code></dt><dd><p>host bridge boundary for the stream pool</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u16</span> <span class="pre">nr</span></code></dt><dd><p>number of streams</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Platform PCI init and/or expert test module use only. Limit IDE
Stream establishment by setting the number of stream resources
available at the host bridge. Platform init code must set this before
the first <a class="reference internal" href="#c.pci_ide_stream_alloc" title="pci_ide_stream_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_ide_stream_alloc()</span></code></a> call if the platform has less than the
default of 256 streams per host-bridge.</p>
<p>The “PCI_IDE” symbol namespace is required because this is typically
a detail that is settled in early PCI init. I.e. this export is not
for endpoint drivers.</p>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.pci_tdi">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tdi</span></span></span><a class="headerlink" href="#c.pci_tdi" title="Link to this definition">¶</a><br /></dt>
<dd><p>Core TEE I/O Device Interface (TDI) context</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pci_tdi {
    struct pci_dev *pdev;
    struct kvm *kvm;
    u32 tdi_id;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pdev</span></code></dt><dd><p>host side representation of guest-side TDI</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kvm</span></code></dt><dd><p>TEE VM context of bound TDI</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tdi_id</span></code></dt><dd><p>Identifier (virtual BDF) for the TDI as referenced by the TSM and DSM</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.pci_tsm">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm</span></span></span><a class="headerlink" href="#c.pci_tsm" title="Link to this definition">¶</a><br /></dt>
<dd><p>Core TSM context for a given PCIe endpoint</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pci_tsm {
    struct pci_dev *pdev;
    struct pci_dev *dsm_dev;
    struct tsm_dev *tsm_dev;
    struct pci_tdi *tdi;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">pdev</span></code></dt><dd><p>Back ref to device function, distinguishes type of pci_tsm context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dsm_dev</span></code></dt><dd><p>PCI Device Security Manager for link operations on <strong>pdev</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tsm_dev</span></code></dt><dd><p>PCI TEE Security Manager device for Link Confidentiality or Device
Function Security operations</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tdi</span></code></dt><dd><p>TDI context established by the <strong>bind</strong> link operation</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This structure is wrapped by low level TSM driver data and returned by
<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">probe()</span></code>/<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">lock()</span></code>, it is freed by the corresponding <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">remove()</span></code>/<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">unlock()</span></code>.</p>
<p>For link operations it serves to cache the association between a Device
Security Manager (DSM) and the functions that manager can assign to a TVM.
That can be “self”, for assigning function0 of a TEE I/O device, a
sub-function (SR-IOV virtual function, or non-function0
multifunction-device), or a downstream endpoint (PCIe upstream switch-port as
DSM).</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.pci_tsm_pf0">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_pf0</span></span></span><a class="headerlink" href="#c.pci_tsm_pf0" title="Link to this definition">¶</a><br /></dt>
<dd><p>Physical Function 0 TDISP link context</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct pci_tsm_pf0 {
    struct pci_tsm base_tsm;
    struct mutex lock;
    struct pci_doe_mb *doe_mb;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">base_tsm</span></code></dt><dd><p>generic core “tsm” context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt><dd><p>mutual exclustion for pci_tsm_ops invocation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">doe_mb</span></code></dt><dd><p>PCIe Data Object Exchange mailbox</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.pci_tsm_req_scope">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_req_scope</span></span></span><a class="headerlink" href="#c.pci_tsm_req_scope" title="Link to this definition">¶</a><br /></dt>
<dd><p>Scope of guest requests to be validated by TSM</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">PCI_TSM_REQ_INFO</span></code></dt><dd><p>Read-only, without side effects, request for
typical TDISP collateral information like Device Interface Reports.
No device secrets are permitted, and no device state is changed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PCI_TSM_REQ_STATE_CHANGE</span></code></dt><dd><p>Request to change the TDISP state from
UNLOCKED-&gt;LOCKED, LOCKED-&gt;RUN, or other architecture specific state
changes to support those transitions for a TDI. No other (unrelated
to TDISP) device / host state, configuration, or data change is
permitted.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PCI_TSM_REQ_DEBUG_READ</span></code></dt><dd><p>Read-only request for debug information</p>
<p>A method to facilitate TVM information retrieval outside of typical
TDISP operational requirements. No device secrets are permitted.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PCI_TSM_REQ_DEBUG_WRITE</span></code></dt><dd><p>Device state changes for debug purposes</p>
<p>The request may affect the operational state of the device outside of
the TDISP operational model. If allowed, requires CAP_SYS_RAW_IO, and
will taint the kernel.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Guest requests are a transport for a TVM to communicate with a TSM + DSM for
a given TDI. A TSM driver is responsible for maintaining the kernel security
model and limit commands that may affect the host, or are otherwise outside
the typical TDISP operational model.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_tsm_bind">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_bind</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm_bind" title="kvm"><span class="n"><span class="pre">kvm</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">kvm</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">tdi_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_tsm_bind" title="Link to this definition">¶</a><br /></dt>
<dd><p>Bind <strong>pdev</strong> as a TDI for <strong>kvm</strong></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>PCI device function to bind</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">kvm</span> <span class="pre">*kvm</span></code></dt><dd><p>Private memory attach context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">tdi_id</span></code></dt><dd><p>Identifier (virtual BDF) for the TDI as referenced by the TSM and DSM</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns 0 on success, or a negative error code on failure.</p>
<p><strong>Context</strong></p>
<p>Caller is responsible for constraining the bind lifetime to the
registered state of the device. For example, <a class="reference internal" href="#c.pci_tsm_bind" title="pci_tsm_bind"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_tsm_bind()</span></code></a> /
<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pci_tsm_unbind()</span></code> limited to the VFIO driver bound state of the device.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_tsm_guest_req">
<span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_guest_req</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm_req_scope" title="pci_tsm_req_scope"><span class="n"><span class="pre">pci_tsm_req_scope</span></span></a><span class="w"> </span><span class="n"><span class="pre">scope</span></span>, <span class="n"><span class="pre">sockptr_t</span></span><span class="w"> </span><span class="n"><span class="pre">req_in</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">in_len</span></span>, <span class="n"><span class="pre">sockptr_t</span></span><span class="w"> </span><span class="n"><span class="pre">req_out</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">out_len</span></span>, <span class="n"><span class="pre">u64</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tsm_code</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_tsm_guest_req" title="Link to this definition">¶</a><br /></dt>
<dd><p>helper to marshal guest requests to the TSM driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p><strong>pdev</strong> representing a bound tdi</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">pci_tsm_req_scope</span> <span class="pre">scope</span></code></dt><dd><p>caller asserts this passthrough request is limited to TDISP operations</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sockptr_t</span> <span class="pre">req_in</span></code></dt><dd><p>Input payload forwarded from the guest</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">in_len</span></code></dt><dd><p>Length of <strong>req_in</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sockptr_t</span> <span class="pre">req_out</span></code></dt><dd><p>Output payload buffer response to the guest</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">out_len</span></code></dt><dd><p>Length of <strong>req_out</strong> on input, bytes filled in <strong>req_out</strong> on output</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">*tsm_code</span></code></dt><dd><p>Optional TSM arch specific result code for the guest TSM</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a common entry point for requests triggered by userspace KVM-exit
service handlers responding to TDI information or state change requests. The
scope parameter limits requests to TDISP state management, or limited debug.
This path is only suitable for commands and results that are the host kernel
has no use, the host is only facilitating guest to TSM communication.</p>
<p>Returns 0 on success and -error on failure and positive “residue” on success
but <strong>req_out</strong> is filled with less then <strong>out_len</strong>, or <strong>req_out</strong> is NULL and a
residue number of bytes were not consumed from <strong>req_in</strong>.  On success or
failure <strong>tsm_code</strong> may be populated with a TSM implementation specific result
code for the guest to consume.</p>
<p><strong>Context</strong></p>
<p>Caller is responsible for calling this within the <a class="reference internal" href="#c.pci_tsm_bind" title="pci_tsm_bind"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_tsm_bind()</span></code></a>
state of the TDI.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_tsm_tdi_constructor">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_tdi_constructor</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tdi" title="pci_tdi"><span class="n"><span class="pre">pci_tdi</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tdi</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm_tdi_constructor" title="kvm"><span class="n"><span class="pre">kvm</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">kvm</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">tdi_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_tsm_tdi_constructor" title="Link to this definition">¶</a><br /></dt>
<dd><p>base ‘<a class="reference internal" href="#c.pci_tdi" title="pci_tdi"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_tdi</span></code></a>’ initialization for link TSMs</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>PCI device function representing the TDI</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_tdi</span> <span class="pre">*tdi</span></code></dt><dd><p>context to initialize</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">kvm</span> <span class="pre">*kvm</span></code></dt><dd><p>Private memory attach context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">tdi_id</span></code></dt><dd><p>Identifier (virtual BDF) for the TDI as referenced by the TSM and DSM</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_tsm_link_constructor">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_link_constructor</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm" title="pci_tsm"><span class="n"><span class="pre">pci_tsm</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tsm</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm_link_constructor" title="tsm_dev"><span class="n"><span class="pre">tsm_dev</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tsm_dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_tsm_link_constructor" title="Link to this definition">¶</a><br /></dt>
<dd><p>base ‘<a class="reference internal" href="#c.pci_tsm" title="pci_tsm"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_tsm</span></code></a>’ initialization for link TSMs</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>The PCI device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_tsm</span> <span class="pre">*tsm</span></code></dt><dd><p>context to initialize</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tsm_dev</span> <span class="pre">*tsm_dev</span></code></dt><dd><p>Platform TEE Security Manager, initiator of security operations</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.pci_tsm_pf0_constructor">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">pci_tsm_pf0_constructor</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">pci_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm_pf0" title="pci_tsm_pf0"><span class="n"><span class="pre">pci_tsm_pf0</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tsm</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.pci_tsm_pf0_constructor" title="tsm_dev"><span class="n"><span class="pre">tsm_dev</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tsm_dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.pci_tsm_pf0_constructor" title="Link to this definition">¶</a><br /></dt>
<dd><p>common ‘<a class="reference internal" href="#c.pci_tsm_pf0" title="pci_tsm_pf0"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_tsm_pf0</span></code></a>’ (DSM) initialization</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_dev</span> <span class="pre">*pdev</span></code></dt><dd><p>Physical Function 0 PCI device (as indicated by <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">is_pci_tsm_pf0()</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_tsm_pf0</span> <span class="pre">*tsm</span></code></dt><dd><p>context to initialize</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tsm_dev</span> <span class="pre">*tsm_dev</span></code></dt><dd><p>Platform TEE Security Manager, initiator of security operations</p>
</dd>
</dl>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/driver-api/pci/tsm.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
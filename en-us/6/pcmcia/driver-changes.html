<!DOCTYPE html>

<html lang="en-US" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Driver changes &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=adfc0c0d" />
    <script src="../_static/documentation_options.js?v=ccd1e645"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/pcmcia/driver-changes.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Serial Peripheral Interface (SPI)" href="../spi/index.html" />
    <link rel="prev" title="Locking" href="locking.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../ltd-provenance.js"></script>
<script type="text/javascript" src="../ltd-current.js"></script>
<script type="text/javascript" src="../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.18.0-rc2</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../subsystem-apis.html#other-subsystems">Other subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpu-freq/index.html">CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../edac/index.html">EDAC Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga/index.html">FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">PCMCIA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../watchdog/index.html">Watchdog Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virt/index.html">Virtualization Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hwmon/index.html">Hardware Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../accel/index.html">Compute Accelerators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crypto/index.html">Crypto API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PCI/index.html">PCI Bus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peci/index.html">PECI Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wmi/index.html">WMI Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tee/index.html">TEE Subsystem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/pcmcia/driver-changes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="driver-changes">
<h1>Driver changes<a class="headerlink" href="#driver-changes" title="Link to this heading">Â¶</a></h1>
<p>This file details changes in 2.6 which affect PCMCIA card driver authors:</p>
<ul>
<li><dl>
<dt>pcmcia_loop_config() and autoconfiguration (as of 2.6.36)</dt><dd><p>If <cite><code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_device</span></code> *p_dev-&gt;config_flags</cite> is set accordingly,
<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_loop_config()</span></code> now sets up certain configuration values
automatically, though the driver may still override the settings
in the callback function. The following autoconfiguration options
are provided at the moment:</p>
<blockquote>
<div><ul class="simple">
<li><p>CONF_AUTO_CHECK_VCC : check for matching Vcc</p></li>
<li><p>CONF_AUTO_SET_VPP   : set Vpp</p></li>
<li><p>CONF_AUTO_AUDIO     : auto-enable audio line, if required</p></li>
<li><p>CONF_AUTO_SET_IO    : set ioport resources (-&gt;resource[0,1])</p></li>
<li><p>CONF_AUTO_SET_IOMEM : set first iomem resource (-&gt;resource[2])</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pcmcia_request_configuration -&gt; pcmcia_enable_device (as of 2.6.36)</dt><dd><p><code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_request_configuration()</span></code> got renamed to <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_enable_device()</span></code>,
as it mirrors <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_disable_device()</span></code>. Configuration settings are now
stored in <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_device</span></code>, e.g. in the fields config_flags,
config_index, config_base, vpp.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pcmcia_request_window changes (as of 2.6.36)</dt><dd><p>Instead of win_req_t, drivers are now requested to fill out
<cite><code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_device</span></code> *p_dev-&gt;resource[2,3,4,5]</cite> for up to four ioport
ranges. After a call to <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_request_window()</span></code>, the regions found there
are reserved and may be used immediately -- until <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_release_window()</span></code>
is called.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pcmcia_request_io changes (as of 2.6.36)</dt><dd><p>Instead of io_req_t, drivers are now requested to fill out
<cite><code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_device</span></code> *p_dev-&gt;resource[0,1]</cite> for up to two ioport
ranges. After a call to <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_request_io()</span></code>, the ports found there
are reserved, after calling <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_request_configuration()</span></code>, they may
be used.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>No dev_info_t, no cs_types.h (as of 2.6.36)</dt><dd><p>dev_info_t and a few other typedefs are removed. No longer use them
in PCMCIA device drivers. Also, do not include pcmcia/cs_types.h, as
this file is gone.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>No dev_node_t (as of 2.6.35)</dt><dd><p>There is no more need to fill out a âdev_node_tâ structure.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>New IRQ request rules (as of 2.6.35)</dt><dd><p>Instead of the old <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_request_irq()</span></code> interface, drivers may now
choose between:</p>
<ul class="simple">
<li><p>calling request_irq/free_irq directly. Use the IRQ from <cite>*p_dev-&gt;irq</cite>.</p></li>
<li><p>use pcmcia_request_irq(p_dev, handler_t); the PCMCIA core will
clean up automatically on calls to <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_disable_device()</span></code> or
device ejection.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>no cs_error / CS_CHECK / CONFIG_PCMCIA_DEBUG (as of 2.6.33)</dt><dd><p>Instead of the <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">cs_error()</span></code> callback or the <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">CS_CHECK()</span></code> macro, please use
Linux-style checking of return values, and -- if necessary -- debug
messages using â<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">dev_dbg()</span></code>â or â<a class="reference internal" href="../core-api/printk-basics.html#c.pr_debug" title="pr_debug"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_debug()</span></code></a>â.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>New CIS tuple access (as of 2.6.33)</dt><dd><p>Instead of pcmcia_get_{first,next}<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">_tuple()</span></code>, <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_get_tuple_data()</span></code> and
<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_parse_tuple()</span></code>, a driver shall use â<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_get_tuple()</span></code>â if it is
only interested in one (raw) tuple, or â<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_loop_tuple()</span></code>â if it is
interested in all tuples of one type. To decode the MAC from CISTPL_FUNCE,
a new helper â<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_get_mac_from_cis()</span></code>â was added.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>New configuration loop helper (as of 2.6.28)</dt><dd><p>By calling <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_loop_config()</span></code>, a driver can iterate over all available
configuration options. During a driverâs <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">probe()</span></code> phase, one doesnât need
to use pcmcia_get_{first,next}_tuple, pcmcia_get_tuple_data and
pcmcia_parse_tuple directly in most if not all cases.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>New release helper (as of 2.6.17)</dt><dd><p>Instead of calling pcmcia_release_{configuration,io,irq,win}, all thatâs
necessary now is calling pcmcia_disable_device. As there is no valid
reason left to call pcmcia_release_io and pcmcia_release_irq, the
exports for them were removed.</p>
</dd>
</dl>
</li>
<li><p>Unify detach and REMOVAL event code, as well as attach and INSERTION
code (as of 2.6.16):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void (*remove)          (struct pcmcia_device *dev);
int (*probe)            (struct pcmcia_device *dev);
</pre></div>
</div>
</li>
<li><p>Move suspend, resume and reset out of event handler (as of 2.6.16):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int (*suspend)          (struct pcmcia_device *dev);
int (*resume)           (struct pcmcia_device *dev);
</pre></div>
</div>
<p>should be initialized in <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_driver</span></code>, and handle
(SUSPEND == RESET_PHYSICAL) and (RESUME == CARD_RESET) events</p>
</li>
<li><dl class="simple">
<dt>event handler initialization in struct pcmcia_driver (as of 2.6.13)</dt><dd><p>The event handler is notified of all events, and must be initialized
as the <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">event()</span></code> callback in the driverâs <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_driver</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>pcmcia/version.h should not be used (as of 2.6.13)</dt><dd><p>This file will be removed eventually.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>in-kernel device&lt;-&gt;driver matching (as of 2.6.13)</dt><dd><p>PCMCIA devices and their correct drivers can now be matched in
kernelspace. See â<a class="reference internal" href="devicetable.html"><span class="doc">Device table</span></a>â for details.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Device model integration (as of 2.6.11)</dt><dd><p>A <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_device</span></code> is registered with the device model core,
and can be used (e.g. for SET_NETDEV_DEV) by using
handle_to_dev(client_handle_t * handle).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Convert internal I/O port addresses to unsigned int (as of 2.6.11)</dt><dd><p>ioaddr_t should be replaced by unsigned int in PCMCIA card drivers.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>irq_mask and irq_list parameters (as of 2.6.11)</dt><dd><p>The irq_mask and irq_list parameters should no longer be used in
PCMCIA card drivers. Instead, it is the job of the PCMCIA core to
determine which IRQ should be used. Therefore, link-&gt;irq.IRQInfo2
is ignored.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>client-&gt;PendingEvents is gone (as of 2.6.11)</dt><dd><p>client-&gt;PendingEvents is no longer available.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>client-&gt;Attributes are gone (as of 2.6.11)</dt><dd><p>client-&gt;Attributes is unused, therefore it is removed from all
PCMCIA card drivers</p>
</dd>
</dl>
</li>
<li><dl>
<dt>core functions no longer available (as of 2.6.11)</dt><dd><p>The following functions have been removed from the kernel source
because they are unused by all in-kernel drivers, and no external
driver was reported to rely on them:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pcmcia_get_first_region()
pcmcia_get_next_region()
pcmcia_modify_window()
pcmcia_set_event_mask()
pcmcia_get_first_window()
pcmcia_get_next_window()
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>device list iteration upon module removal (as of 2.6.10)</dt><dd><p>It is no longer necessary to iterate on the driverâs internal
client list and call the -&gt;<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">detach()</span></code> function upon module removal.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Resource management. (as of 2.6.8)</dt><dd><p>Although the PCMCIA subsystem will allocate resources for cards,
it no longer marks these resources busy. This means that driver
authors are now responsible for claiming your resources as per
other drivers in Linux. You should use <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">request_region()</span></code> to mark
your IO regions in-use, and <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">request_mem_region()</span></code> to mark your
memory regions in-use. The name argument should be a pointer to
your driver name. Eg, for pcnet_cs, name should point to the
string âpcnet_csâ.</p>
</dd>
</dl>
</li>
<li><p>CardServices is gone
<code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">CardServices()</span></code> in 2.4 is just a big switch statement to call various
services.  In 2.6, all of those entry points are exported and called
directly (except for <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">pcmcia_report_error()</span></code>, just use <code class="xref c c-func broken_xref docutils literal notranslate"><span class="pre">cs_error()</span></code> instead).</p></li>
<li><p><code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_driver</span></code>
You need to use <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pcmcia_driver</span></code> and pcmcia_{un,}register_driver
instead of {un,}register_pccard_driver</p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/pcmcia/driver-changes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
<!DOCTYPE html>

<html lang="en-US" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2.13.1. V4L2_META_FMT_MALI_C55_STATS (‘C55S’), V4L2_META_FMT_MALI_C55_PARAMS (‘C55P’) &#8212; The Linux Kernel unknown version documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=adfc0c0d" />
    <script src="../../../_static/documentation_options.js?v=750ed68d"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/linux-docs-l10n/userspace-api/media/v4l/metafmt-arm-mali-c55.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="2.13.2. V4L2_META_FMT_C3ISP_STATS (‘C3ST’), V4L2_META_FMT_C3ISP_PARAMS (‘C3PM’)" href="metafmt-c3-isp.html" />
    <link rel="prev" title="2.13. Metadata Formats" href="meta-formats.html" />

   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.19.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>


<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Userspace API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#system-calls">System calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#security-related-interfaces">Security-related interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#devices-and-i-o">Devices and I/O</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../accelerators/ocxl.html">OpenCAPI (Open Coherent Accelerator Processor Interface)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dma-buf-heaps.html">Allocating dma-buf using heaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dma-buf-alloc-exchange.html">Exchanging pixel buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fwctl/index.html">Firmware Control (FWCTL) Userspace API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gpio/index.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../iommufd.html">IOMMUFD</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vduse.html">VDUSE - “vDPA Device in Userspace”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../isapnp.html">ISA Plug &amp; Play support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#everything-else">Everything else</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/userspace-api/media/v4l/metafmt-arm-mali-c55.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="v4l2-meta-fmt-mali-c55-stats-c55s-v4l2-meta-fmt-mali-c55-params-c55p">
<span id="v4l2-meta-fmt-mali-c55-stats"></span><span id="v4l2-meta-fmt-mali-c55-params"></span><h1><span class="section-number">2.13.1. </span>V4L2_META_FMT_MALI_C55_STATS (‘C55S’), V4L2_META_FMT_MALI_C55_PARAMS (‘C55P’)<a class="headerlink" href="#v4l2-meta-fmt-mali-c55-stats-c55s-v4l2-meta-fmt-mali-c55-params-c55p" title="Link to this heading">¶</a></h1>
<section id="a-statistics">
<h2><span class="section-number">2.13.1.1. </span>3A Statistics<a class="headerlink" href="#a-statistics" title="Link to this heading">¶</a></h2>
<p>The ISP device collects different statistics over an input bayer frame. Those
statistics can be obtained by userspace from the
<a class="reference internal" href="../../../admin-guide/media/mali-c55.html#mali-c55-3a-stats"><span class="std std-ref">mali-c55 3a stats</span></a> metadata capture video node, using
the <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_meta_format</span></code> interface. The buffer contains a single instance
of the C structure <a class="reference internal" href="#c.mali_c55_stats_buffer" title="mali_c55_stats_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_stats_buffer</span></code></a> defined in
<code class="docutils literal notranslate"><span class="pre">mali-c55-config.h</span></code>, so the structure can be obtained from the buffer by:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_stats_buffer</span><span class="w"> </span><span class="o">*</span><span class="n">stats</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_stats_buffer</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">buf</span><span class="p">;</span>
</pre></div>
</div>
<p>For details of the statistics see <a class="reference internal" href="#c.mali_c55_stats_buffer" title="mali_c55_stats_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_stats_buffer</span></code></a>.</p>
</section>
<section id="configuration-parameters">
<h2><span class="section-number">2.13.1.2. </span>Configuration Parameters<a class="headerlink" href="#configuration-parameters" title="Link to this heading">¶</a></h2>
<p>The configuration parameters are passed to the <a class="reference internal" href="../../../admin-guide/media/mali-c55.html#mali-c55-3a-params"><span class="std std-ref">mali-c55 3a params</span></a> metadata output video node, using the
<code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_meta_format</span></code> interface. Rather than a single <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">containing</span></code>
sub-structs for each configurable area of the ISP, parameters for the Mali-C55
use the v4l2-isp parameters system, through which groups of parameters are
defined as distinct structs or “blocks” which may be added to the data member of
<a class="reference internal" href="v4l2-isp.html#c.v4l2_isp_params_buffer" title="v4l2_isp_params_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_isp_params_buffer</span></code></a>. Userspace is responsible for populating the
data member with the blocks that need to be configured by the driver.  Each
block-specific <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">embeds</span></code> <a class="reference internal" href="v4l2-isp.html#c.v4l2_isp_params_block_header" title="v4l2_isp_params_block_header"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_isp_params_block_header</span></code></a> as its first
member and userspace must populate the type member with a value from
<a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">v4l2_isp_params_buffer</span><span class="w"> </span><span class="o">*</span><span class="n">params</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">v4l2_isp_params_buffer</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">;</span>

<span class="n">params</span><span class="o">-&gt;</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V4L2_ISP_PARAMS_VERSION_V1</span><span class="p">;</span>
<span class="n">params</span><span class="o">-&gt;</span><span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_awb_gains</span><span class="w"> </span><span class="o">*</span><span class="n">gains</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_awb_gains</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>

<span class="n">gains</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MALI_C55_PARAM_BLOCK_AWB_GAINS</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">V4L2_ISP_PARAMS_FL_BLOCK_ENABLE</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_awb_gains</span><span class="p">);</span>

<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gain00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gain00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gain00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gain00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>

<span class="n">data</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_awb_gains</span><span class="p">);</span>
<span class="n">params</span><span class="o">-&gt;</span><span class="n">data_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_awb_gains</span><span class="p">);</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_sensor_off_preshading</span><span class="w"> </span><span class="o">*</span><span class="n">blc</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_sensor_off_preshading</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>

<span class="n">blc</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MALI_C55_PARAM_BLOCK_SENSOR_OFFS</span><span class="p">;</span>
<span class="n">blc</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">V4L2_ISP_PARAMS_FL_BLOCK_ENABLE</span><span class="p">;</span>
<span class="n">blc</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_sensor_off_preshading</span><span class="p">);</span>

<span class="n">blc</span><span class="o">-&gt;</span><span class="n">chan00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">51200</span><span class="p">;</span>
<span class="n">blc</span><span class="o">-&gt;</span><span class="n">chan01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">51200</span><span class="p">;</span>
<span class="n">blc</span><span class="o">-&gt;</span><span class="n">chan10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">51200</span><span class="p">;</span>
<span class="n">blc</span><span class="o">-&gt;</span><span class="n">chan11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">51200</span><span class="p">;</span>

<span class="n">params</span><span class="o">-&gt;</span><span class="n">data_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">mali_c55_params_sensor_off_preshading</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="arm-mali-c55-uapi-data-types">
<h2><span class="section-number">2.13.1.3. </span>Arm Mali-C55 uAPI data types<a class="headerlink" href="#arm-mali-c55-uapi-data-types" title="Link to this heading">¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_ae_1024bin_hist">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_ae_1024bin_hist</span></span></span><a class="headerlink" href="#c.mali_c55_ae_1024bin_hist" title="Link to this definition">¶</a><br /></dt>
<dd><p>Auto Exposure 1024-bin histogram statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_ae_1024bin_hist {
    __u16 bins[1024];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">bins</span></code></dt><dd><p>1024 element array of 16-bit pixel counts.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The 1024-bin histogram module collects image-global but zone-weighted
intensity distributions of pixels in fixed-width bins. The modules can be
configured into different “plane modes” which affect the contents of the
collected statistics. In plane mode 0, pixel intensities are taken regardless
of colour plane into a single 1024-bin histogram with a bin width of 4. In
plane mode 1, four 256-bin histograms with a bin width of 16 are collected -
one for each CFA colour plane. In plane modes 4, 5, 6 and 7 two 512-bin
histograms with a bin width of 8 are collected - in each mode one of the
colour planes is collected into the first histogram and all the others are
combined into the second. The histograms are stored consecutively in the bins
array.</p>
<p>The 16-bit pixel counts are stored as a 4-bit exponent in the most
significant bits followed by a 12-bit mantissa. Conversion to a usable
format can be done according to the following pseudo-code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (e == 0) {
        bin = m * 2;
} else {
        bin = (m + 4096) * 2^e
}
</pre></div>
</div>
<dl class="simple">
<dt>where</dt><dd><p>e is the exponent value in range 0..15
m is the mantissa value in range 0..4095</p>
</dd>
</dl>
<p>The pixels used in calculating the statistics can be masked using three
methods:</p>
<ol class="arabic simple">
<li><p>Pixels can be skipped in X and Y directions independently.</p></li>
<li><p>Minimum/Maximum intensities can be configured</p></li>
<li><p>Zones can be differentially weighted, including 0 weighted to mask them</p></li>
</ol>
<p>The data for this histogram can be collected from different tap points in the
ISP depending on configuration - after the white balance or digital gain
blocks, or immediately after the input crossbar.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_ae_5bin_hist">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_ae_5bin_hist</span></span></span><a class="headerlink" href="#c.mali_c55_ae_5bin_hist" title="Link to this definition">¶</a><br /></dt>
<dd><p>Auto Exposure 5-bin histogram statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_ae_5bin_hist {
    __u16 hist0;
    __u16 hist1;
    __u16 hist3;
    __u16 hist4;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">hist0</span></code></dt><dd><p>16-bit normalised pixel count for the 0th intensity bin</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist1</span></code></dt><dd><p>16-bit normalised pixel count for the 1st intensity bin</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist3</span></code></dt><dd><p>16-bit normalised pixel count for the 3rd intensity bin</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist4</span></code></dt><dd><p>16-bit normalised pixel count for the 4th intensity bin</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The ISP generates a 5-bin histogram of normalised pixel counts within bins of
pixel intensity for each of 225 possible zones within a frame. The centre bin
of the histogram for each zone is not available from the hardware and must be
calculated by subtracting the values of hist0, hist1, hist3 and hist4 from
0xffff as in the following equation:</p>
<blockquote>
<div><p>hist2 = 0xffff - (hist0 + hist1 + hist3 + hist4)</p>
</div></blockquote>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_awb_average_ratios">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_awb_average_ratios</span></span></span><a class="headerlink" href="#c.mali_c55_awb_average_ratios" title="Link to this definition">¶</a><br /></dt>
<dd><p>Auto White Balance colour ratios</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_awb_average_ratios {
    __u16 avg_rg_gr;
    __u16 avg_bg_br;
    __u32 num_pixels;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">avg_rg_gr</span></code></dt><dd><p>Average R/G or G/R ratio in Q4.8 format.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">avg_bg_br</span></code></dt><dd><p>Average B/G or B/R ratio in Q4.8 format.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_pixels</span></code></dt><dd><p>The number of pixels used in the AWB calculation</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The ISP calculates and collects average colour ratios for each zone in an
image and stores them in Q4.8 format (the lowest 8 bits are fractional, with
bits [11:8] representing the integer). The exact ratios collected (either
R/G, B/G or G/R, B/R) are configurable through the parameters buffer. The
value of the 4 high bits is undefined.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_af_statistics">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_af_statistics</span></span></span><a class="headerlink" href="#c.mali_c55_af_statistics" title="Link to this definition">¶</a><br /></dt>
<dd><p>Auto Focus edge and intensity statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_af_statistics {
    __u16 intensity_stats;
    __u16 edge_stats;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">intensity_stats</span></code></dt><dd><p>Packed mantissa and exponent value for pixel intensity</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">edge_stats</span></code></dt><dd><p>Packed mantissa and exponent values for edge intensity</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The ISP collects the squared sum of pixel intensities for each zone within a
configurable Region of Interest on the frame. Additionally, the same data are
collected after being passed through a bandpass filter which removes high and
low frequency components - these are referred to as the edge statistics.</p>
<p>The intensity and edge statistics for a zone can be used to calculate the
contrast information for a zone</p>
<blockquote>
<div><p>C = E2 / I2</p>
</div></blockquote>
<p>Where I2 is the intensity statistic for a zone and E2 is the edge statistic
for that zone. Optimum focus is reached when C is at its maximum.</p>
<p>The intensity and edge statistics are stored packed into a non-standard 16
bit floating point format, where the 7 most significant bits represent the
exponent and the 9 least significant bits the mantissa. This format can be
unpacked with the following pseudocode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (e == 0) {
        x = m;
} else {
        x = 2^e-1 * (m + 2^9)
}
</pre></div>
</div>
<dl class="simple">
<dt>where</dt><dd><p>e is the exponent value in range 0..127
m is the mantissa value in range 0..511</p>
</dd>
</dl>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_stats_buffer">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_stats_buffer</span></span></span><a class="headerlink" href="#c.mali_c55_stats_buffer" title="Link to this definition">¶</a><br /></dt>
<dd><p>3A statistics for the mali-c55 ISP</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_stats_buffer {
    struct mali_c55_ae_1024bin_hist ae_1024bin_hist;
    struct mali_c55_ae_1024bin_hist iridix_1024bin_hist;
    struct mali_c55_ae_5bin_hist ae_5bin_hists[MALI_C55_MAX_ZONES];
    __u32 reserved1[14];
    struct mali_c55_awb_average_ratios awb_ratios[MALI_C55_MAX_ZONES];
    __u32 reserved2[14];
    struct mali_c55_af_statistics af_statistics[MALI_C55_MAX_ZONES];
    __u32 reserved3[15];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ae_1024bin_hist</span></code></dt><dd><p>1024-bin frame-global pixel intensity histogram</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">iridix_1024bin_hist</span></code></dt><dd><p>Post-Iridix block 1024-bin histogram</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ae_5bin_hists</span></code></dt><dd><p>5-bin pixel intensity histograms for AEC</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved1</span></code></dt><dd><p>Undefined buffer space</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">awb_ratios</span></code></dt><dd><p>Color balance ratios for Auto White Balance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved2</span></code></dt><dd><p>Undefined buffer space</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">af_statistics</span></code></dt><dd><p>Pixel intensity statistics for Auto Focus</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved3</span></code></dt><dd><p>Undefined buffer space</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">describes</span></code> the metering statistics space in the Mali-C55 ISP’s
hardware in its entirety. The space between each defined area is marked as
“unknown” and may not be 0, but should not be used. The <strong>ae_5bin_hists</strong>,
<strong>awb_ratios</strong> and <strong>af_statistics</strong> members are arrays of statistics per-zone.
The zones are arranged in the array in raster order starting from the top
left corner of the image.</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_param_block_type">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_param_block_type</span></span></span><a class="headerlink" href="#c.mali_c55_param_block_type" title="Link to this definition">¶</a><br /></dt>
<dd><p>Enumeration of Mali-C55 parameter blocks</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_SENSOR_OFFS</span></code></dt><dd><p>Sensor pre-shading black level offset</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AEXP_HIST</span></code></dt><dd><p>Auto-exposure 1024-bin histogram
configuration</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AEXP_IHIST</span></code></dt><dd><p>Post-Iridix auto-exposure 1024-bin
histogram configuration</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AEXP_HIST_WEIGHTS</span></code></dt><dd><p>Auto-exposure 1024-bin histogram
weighting</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AEXP_IHIST_WEIGHTS</span></code></dt><dd><p>Post-Iridix auto-exposure 1024-bin
histogram weighting</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_DIGITAL_GAIN</span></code></dt><dd><p>Digital gain</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AWB_GAINS</span></code></dt><dd><p>Auto-white balance gains</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AWB_CONFIG</span></code></dt><dd><p>Auto-white balance statistics config</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_BLOCK_AWB_GAINS_AEXP</span></code></dt><dd><p>Auto-white balance gains for AEXP-0 tap</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_MESH_SHADING_CONFIG</span></code></dt><dd><p>Mesh shading tables configuration</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAM_MESH_SHADING_SELECTION</span></code></dt><dd><p>Mesh shading table selection</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This enumeration defines the types of Mali-C55 parameters block. Each block
configures a specific processing block of the Mali-C55 ISP. The block
type allows the driver to correctly interpret the parameters block data.</p>
<p>It is the responsibility of userspace to correctly set the type of each
parameters block.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_sensor_off_preshading">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_sensor_off_preshading</span></span></span><a class="headerlink" href="#c.mali_c55_params_sensor_off_preshading" title="Link to this definition">¶</a><br /></dt>
<dd><p>offset subtraction for each color channel</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_sensor_off_preshading {
    struct v4l2_isp_params_block_header header;
    __u32 chan00;
    __u32 chan01;
    __u32 chan10;
    __u32 chan11;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">chan00</span></code></dt><dd><p>Offset for color channel 00 (default: R)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">chan01</span></code></dt><dd><p>Offset for color channel 01 (default: Gr)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">chan10</span></code></dt><dd><p>Offset for color channel 10 (default: Gb)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">chan11</span></code></dt><dd><p>Offset for color channel 11 (default: B)</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Provides removal of the sensor black level from the sensor data. Separate
offsets are provided for each of the four Bayer component color channels
which are defaulted to R, Gr, Gb, B.</p>
<p>header.type should be set to MALI_C55_PARAM_BLOCK_SENSOR_OFFS from
<a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a> for this block.</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_aexp_hist_tap_points">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_aexp_hist_tap_points</span></span></span><a class="headerlink" href="#c.mali_c55_aexp_hist_tap_points" title="Link to this definition">¶</a><br /></dt>
<dd><p>Tap points for the AEXP histogram</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_TAP_WB</span></code></dt><dd><p>After static white balance</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_TAP_FS</span></code></dt><dd><p>After WDR Frame Stitch</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_TAP_TPG</span></code></dt><dd><p>After the test pattern generator</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_aexp_skip_x">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_aexp_skip_x</span></span></span><a class="headerlink" href="#c.mali_c55_aexp_skip_x" title="Link to this definition">¶</a><br /></dt>
<dd><p>Horizontal pixel skipping</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_X_EVERY_2ND</span></code></dt><dd><p>Collect every 2nd pixel horizontally</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_X_EVERY_3RD</span></code></dt><dd><p>Collect every 3rd pixel horizontally</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_X_EVERY_4TH</span></code></dt><dd><p>Collect every 4th pixel horizontally</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_X_EVERY_5TH</span></code></dt><dd><p>Collect every 5th pixel horizontally</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_X_EVERY_8TH</span></code></dt><dd><p>Collect every 8th pixel horizontally</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_X_EVERY_9TH</span></code></dt><dd><p>Collect every 9th pixel horizontally</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_aexp_skip_y">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_aexp_skip_y</span></span></span><a class="headerlink" href="#c.mali_c55_aexp_skip_y" title="Link to this definition">¶</a><br /></dt>
<dd><p>Vertical pixel skipping</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_ALL</span></code></dt><dd><p>Collect every single pixel vertically</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_EVERY_2ND</span></code></dt><dd><p>Collect every 2nd pixel vertically</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_EVERY_3RD</span></code></dt><dd><p>Collect every 3rd pixel vertically</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_EVERY_4TH</span></code></dt><dd><p>Collect every 4th pixel vertically</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_EVERY_5TH</span></code></dt><dd><p>Collect every 5th pixel vertically</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_EVERY_8TH</span></code></dt><dd><p>Collect every 8th pixel vertically</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SKIP_Y_EVERY_9TH</span></code></dt><dd><p>Collect every 9th pixel vertically</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_aexp_row_column_offset">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_aexp_row_column_offset</span></span></span><a class="headerlink" href="#c.mali_c55_aexp_row_column_offset" title="Link to this definition">¶</a><br /></dt>
<dd><p>Start from the first or second row or column</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_FIRST_ROW_OR_COL</span></code></dt><dd><p>Start from the first row / column</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_SECOND_ROW_OR_COL</span></code></dt><dd><p>Start from the second row / column</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_aexp_hist_plane_mode">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_aexp_hist_plane_mode</span></span></span><a class="headerlink" href="#c.mali_c55_aexp_hist_plane_mode" title="Link to this definition">¶</a><br /></dt>
<dd><p>Mode for the AEXP Histograms</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_COMBINED</span></code></dt><dd><p>All color planes in one 1024-bin histogram</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_SEPARATE</span></code></dt><dd><p>Each color plane in one 256-bin histogram with a bin width of 16</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_FOCUS_00</span></code></dt><dd><p>Top left plane in the first bank, rest in second bank</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_FOCUS_01</span></code></dt><dd><p>Top right plane in the first bank, rest in second bank</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_FOCUS_10</span></code></dt><dd><p>Bottom left plane in the first bank, rest in second bank</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AEXP_HIST_FOCUS_11</span></code></dt><dd><p>Bottom right plane in the first bank, rest in second bank</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>In the “focus” modes statistics are collected into two 512-bin histograms
with a bin width of 8. One colour plane is in the first histogram with the
remainder combined into the second. The four options represent which of the
four positions in a bayer pattern are the focused plane.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_aexp_hist">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_aexp_hist</span></span></span><a class="headerlink" href="#c.mali_c55_params_aexp_hist" title="Link to this definition">¶</a><br /></dt>
<dd><p>configuration for AEXP metering hists</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_aexp_hist {
    struct v4l2_isp_params_block_header header;
    __u8 skip_x;
    __u8 offset_x;
    __u8 skip_y;
    __u8 offset_y;
    __u8 scale_bottom;
    __u8 scale_top;
    __u8 plane_mode;
    __u8 tap_point;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">skip_x</span></code></dt><dd><p>Horizontal decimation. See <a class="reference internal" href="#c.mali_c55_aexp_skip_x" title="mali_c55_aexp_skip_x"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_aexp_skip_x</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">offset_x</span></code></dt><dd><p>Skip the first column, or not. See <a class="reference internal" href="#c.mali_c55_aexp_row_column_offset" title="mali_c55_aexp_row_column_offset"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_aexp_row_column_offset</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">skip_y</span></code></dt><dd><p>Vertical decimation. See <a class="reference internal" href="#c.mali_c55_aexp_skip_y" title="mali_c55_aexp_skip_y"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_aexp_skip_y</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">offset_y</span></code></dt><dd><p>Skip the first row, or not. See <a class="reference internal" href="#c.mali_c55_aexp_row_column_offset" title="mali_c55_aexp_row_column_offset"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_aexp_row_column_offset</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scale_bottom</span></code></dt><dd><p>Scale pixels in bottom half of intensity range: 0=1x ,1=2x, 2=4x, 4=8x, 4=16x</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scale_top</span></code></dt><dd><p>scale pixels in top half of intensity range: 0=1x ,1=2x, 2=4x, 4=8x, 4=16x</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">plane_mode</span></code></dt><dd><p>Plane separation mode. See <a class="reference internal" href="#c.mali_c55_aexp_hist_plane_mode" title="mali_c55_aexp_hist_plane_mode"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_aexp_hist_plane_mode</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tap_point</span></code></dt><dd><p>Tap point for histogram from <a class="reference internal" href="#c.mali_c55_aexp_hist_tap_points" title="mali_c55_aexp_hist_tap_points"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_aexp_hist_tap_points</span></code></a>.
This parameter is unused for the post-Iridix Histogram</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">allows</span></code> users to configure the 1024-bin AEXP histograms. Broadly
speaking the parameters allow you to mask particular regions of the image and
to select different kinds of histogram.</p>
<p>The skip_x, offset_x, skip_y and offset_y fields allow users to ignore or
mask pixels in the frame by their position relative to the top left pixel.
First, the skip_y, offset_x and offset_y fields define which of the pixels
within each 2x2 region will be counted in the statistics.</p>
<p>If skip_y == 0 then two pixels from each covered region will be counted. If
both offset_x and offset_y are zero, then the two left-most pixels in each
2x2 pixel region will be counted. Setting offset_x = 1 will discount the top
left pixel and count the top right pixel. Setting offset_y = 1 will discount
the bottom left pixel and count the bottom right pixel.</p>
<p>If skip_y != 0 then only a single pixel from each region covered by the
pattern will be counted. In this case offset_x controls whether the pixel
that’s counted is in the left (if offset_x == 0) or right (if offset_x == 1)
column and offset_y controls whether the pixel that’s counted is in the top
(if offset_y == 0) or bottom (if offset_y == 1) row.</p>
<p>The skip_x and skip_y fields control how the 2x2 pixel region is repeated
across the image data. The first instance of the region is always in the top
left of the image data. The skip_x field controls how many pixels are ignored
in the x direction before the pixel masking region is repeated. The skip_y
field controls how many pixels are ignored in the y direction before the
pixel masking region is repeated.</p>
<p>These fields can be used to reduce the number of pixels counted for the
statistics, but it’s important to be careful to configure them correctly.
Some combinations of values will result in colour components from the input
data being ignored entirely, for example in the following configuration:</p>
<p>skip_x = 0
offset_x = 0
skip_y = 0
offset_y = 0</p>
<p>Only the R and Gb components of RGGB data that was input would be collected.
Similarly in the following configuration:</p>
<p>skip_x = 0
offset_x = 0
skip_y = 1
offset_y = 1</p>
<p>Only the Gb component of RGGB data that was input would be collected. To
correct things such that all 4 colour components were included it would be
necessary to set the skip_x and skip_y fields in a way that resulted in all
four colour components being collected:</p>
<p>skip_x = 1
offset_x = 0
skip_y = 1
offset_y = 1</p>
<p>header.type should be set to one of either MALI_C55_PARAM_BLOCK_AEXP_HIST or
MALI_C55_PARAM_BLOCK_AEXP_IHIST from <a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a>.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_aexp_weights">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_aexp_weights</span></span></span><a class="headerlink" href="#c.mali_c55_params_aexp_weights" title="Link to this definition">¶</a><br /></dt>
<dd><p>Array of weights for AEXP metering</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_aexp_weights {
    struct v4l2_isp_params_block_header header;
    __u8 nodes_used_horiz;
    __u8 nodes_used_vert;
    __u8 zone_weights[MALI_C55_MAX_ZONES];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nodes_used_horiz</span></code></dt><dd><p>Number of active zones horizontally [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nodes_used_vert</span></code></dt><dd><p>Number of active zones vertically [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zone_weights</span></code></dt><dd><p>Zone weighting. Index is row*col where 0,0 is the top
left zone continuing in raster order. Each zone can be
weighted in the range [0..15]. The number of rows and
columns is defined by <strong>nodes_used_vert</strong> and
<strong>nodes_used_horiz</strong></p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">allows</span></code> users to configure the weighting for both of the 1024-bin
AEXP histograms. The pixel data collected for each zone is multiplied by the
corresponding weight from this array, which may be zero if the intention is
to mask off the zone entirely.</p>
<p>header.type should be set to one of either MALI_C55_PARAM_BLOCK_AEXP_HIST_WEIGHTS
or MALI_C55_PARAM_BLOCK_AEXP_IHIST_WEIGHTS from <a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a>.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_digital_gain">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_digital_gain</span></span></span><a class="headerlink" href="#c.mali_c55_params_digital_gain" title="Link to this definition">¶</a><br /></dt>
<dd><p>Digital gain value</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_digital_gain {
    struct v4l2_isp_params_block_header header;
    __u16 gain;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gain</span></code></dt><dd><p>The digital gain value to apply, in Q5.8 format.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">carries</span></code> a digital gain value to set in the ISP.</p>
<p>header.type should be set to MALI_C55_PARAM_BLOCK_DIGITAL_GAIN from
<a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a> for this block.</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_awb_stats_mode">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_awb_stats_mode</span></span></span><a class="headerlink" href="#c.mali_c55_awb_stats_mode" title="Link to this definition">¶</a><br /></dt>
<dd><p>Statistics mode for AWB</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AWB_MODE_GRBR</span></code></dt><dd><p>Statistics collected as Green/Red and Blue/Red ratios</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AWB_MODE_RGBG</span></code></dt><dd><p>Statistics collected as Red/Green and Blue/Green ratios</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_awb_gains">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_awb_gains</span></span></span><a class="headerlink" href="#c.mali_c55_params_awb_gains" title="Link to this definition">¶</a><br /></dt>
<dd><p>Gain settings for auto white balance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_awb_gains {
    struct v4l2_isp_params_block_header header;
    __u16 gain00;
    __u16 gain01;
    __u16 gain10;
    __u16 gain11;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gain00</span></code></dt><dd><p>Multiplier for colour channel 00</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gain01</span></code></dt><dd><p>Multiplier for colour channel 01</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gain10</span></code></dt><dd><p>Multiplier for colour channel 10</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gain11</span></code></dt><dd><p>Multiplier for colour channel 11</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">allows</span></code> users to configure the gains for auto-white balance. There
are four gain settings corresponding to each colour channel in the bayer
domain. Although named generically, the association between the gain applied
and the colour channel is done automatically within the ISP depending on the
input format, and so the following mapping always holds true:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gain00 = R
gain01 = Gr
gain10 = Gb
gain11 = B
</pre></div>
</div>
<p>All of the gains are stored in Q4.8 format.</p>
<p>header.type should be set to one of either MALI_C55_PARAM_BLOCK_AWB_GAINS or
MALI_C55_PARAM_BLOCK_AWB_GAINS_AEXP from <a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a>.</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.mali_c55_params_awb_tap_points">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_awb_tap_points</span></span></span><a class="headerlink" href="#c.mali_c55_params_awb_tap_points" title="Link to this definition">¶</a><br /></dt>
<dd><p>Tap points for the AWB statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AWB_STATS_TAP_PF</span></code></dt><dd><p>Immediately after the Purple Fringe block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MALI_C55_AWB_STATS_TAP_CNR</span></code></dt><dd><p>Immediately after the CNR block</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_awb_config">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_awb_config</span></span></span><a class="headerlink" href="#c.mali_c55_params_awb_config" title="Link to this definition">¶</a><br /></dt>
<dd><p>Stats settings for auto-white balance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_awb_config {
    struct v4l2_isp_params_block_header header;
    __u8 tap_point;
    __u8 stats_mode;
    __u16 white_level;
    __u16 black_level;
    __u16 cr_max;
    __u16 cr_min;
    __u16 cb_max;
    __u16 cb_min;
    __u8 nodes_used_horiz;
    __u8 nodes_used_vert;
    __u16 cr_high;
    __u16 cr_low;
    __u16 cb_high;
    __u16 cb_low;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tap_point</span></code></dt><dd><p>The tap point from <a class="reference internal" href="#c.mali_c55_params_awb_tap_points" title="mali_c55_params_awb_tap_points"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_params_awb_tap_points</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stats_mode</span></code></dt><dd><p>AWB statistics collection mode, see <a class="reference internal" href="#c.mali_c55_awb_stats_mode" title="mali_c55_awb_stats_mode"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_awb_stats_mode</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">white_level</span></code></dt><dd><p>Upper pixel intensity (I.E. raw pixel values) limit</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">black_level</span></code></dt><dd><p>Lower pixel intensity (I.E. raw pixel values) limit</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cr_max</span></code></dt><dd><p>Maximum R/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cr_min</span></code></dt><dd><p>Minimum R/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb_max</span></code></dt><dd><p>Maximum B/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb_min</span></code></dt><dd><p>Minimum B/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nodes_used_horiz</span></code></dt><dd><p>Number of active zones horizontally [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nodes_used_vert</span></code></dt><dd><p>Number of active zones vertically [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cr_high</span></code></dt><dd><p>R/G ratio trim high (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cr_low</span></code></dt><dd><p>R/G ratio trim low (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb_high</span></code></dt><dd><p>B/G ratio trim high (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb_low</span></code></dt><dd><p>B/G ratio trim low (Q4.8 format)</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">allows</span></code> the configuration of the statistics generated for auto
white balance. Pixel intensity limits can be set to exclude overly bright or
dark regions of an image from the statistics entirely. Colour ratio minima
and maxima can be set to discount pixels who’s ratios fall outside the
defined boundaries; there are two sets of registers to do this - the
“min/max” ratios which bound a region and the “high/low” ratios which further
trim the upper and lower ratios. For example with the boundaries configured
as follows, only pixels whos colour ratios falls into the region marked “A”
would be counted:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                                         cr_high
   2.0 |                                                   |
       |               cb_max --&gt; _________________________v_____
   1.8 |                         |                         \    |
       |                         |                          \   |
   1.6 |                         |                           \  |
       |                         |                            \ |
c  1.4 |               cb_low --&gt;|\              A             \|&lt;--  cb_high
b      |                         | \                            |
   1.2 |                         |  \                           |
r      |                         |   \                          |
a  1.0 |              cb_min --&gt; |____\_________________________|
t      |                         ^    ^                         ^
i  0.8 |                         |    |                         |
o      |                      cr_min  |                       cr_max
s  0.6 |                              |
       |                             cr_low
   0.4 |
       |
   0.2 |
       |
   0.0 |_______________________________________________________________
       0.0   0.2   0.4   0.6   0.8   1.0   1.2   1.4   1.6   1.8   2.0
                                  cr ratios
</pre></div>
</div>
<p>header.type should be set to MALI_C55_PARAM_BLOCK_AWB_CONFIG from
<a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a> for this block.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_mesh_shading_config">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_mesh_shading_config</span></span></span><a class="headerlink" href="#c.mali_c55_params_mesh_shading_config" title="Link to this definition">¶</a><br /></dt>
<dd><p>Mesh shading configuration</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_mesh_shading_config {
    struct v4l2_isp_params_block_header header;
    __u8 mesh_show;
    __u8 mesh_scale;
    __u8 mesh_page_r;
    __u8 mesh_page_g;
    __u8 mesh_page_b;
    __u8 mesh_width;
    __u8 mesh_height;
    __u32 mesh[MALI_C55_NUM_MESH_SHADING_ELEMENTS];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_show</span></code></dt><dd><p>Output the mesh data rather than image data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_scale</span></code></dt><dd><p>Set the precision and maximum gain range of mesh shading
- 0 = 0-2x gain
- 1 = 0-4x gain
- 2 = 0-8x gain
- 3 = 0-16x gain
- 4 = 1-2x gain
- 5 = 1-3x gain
- 6 = 1-5x gain
- 7 = 1-9x gain</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_page_r</span></code></dt><dd><p>Mesh page select for red colour plane [0..2]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_page_g</span></code></dt><dd><p>Mesh page select for green colour plane [0..2]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_page_b</span></code></dt><dd><p>Mesh page select for blue colour plane [0..2]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_width</span></code></dt><dd><p>Number of horizontal nodes minus 1 [15,31]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_height</span></code></dt><dd><p>Number of vertical nodes minus 1 [15,31]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh</span></code></dt><dd><p>Mesh shading correction tables</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The mesh shading correction module allows programming a separate table of
either 16x16 or 32x32 node coefficients for 3 different light sources. The
final correction coefficients applied are computed by blending the
coefficients from two tables together.</p>
<p>A page of 1024 32-bit integers is associated to each colour channel, with
pages stored consecutively in memory. Each 32-bit integer packs 3 8-bit
correction coefficients for a single node, one for each of the three light
sources. The 8 most significant bits are unused. The following table
describes the layout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+----------- Page (Colour Plane) 0 -------------+
| @mesh[i]  | Mesh Point | Bits  | Light Source |
+-----------+------------+-------+--------------+
|         0 |        0,0 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
|         1 |        0,1 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
|       ... |        ... | ...   | ...          |
+-----------+------------+-------+--------------+
|      1023 |      31,31 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+----------- Page (Colour Plane) 1 -------------+
| @mesh[i]  | Mesh Point | Bits  | Light Source |
+-----------+------------+-------+--------------+
|      1024 |        0,0 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
|      1025 |        0,1 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
|       ... |        ... | ...   | ...          |
+-----------+------------+-------+--------------+
|      2047 |      31,31 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+----------- Page (Colour Plane) 2 -------------+
| @mesh[i]  | Mesh Point | Bits  | Light Source |
+-----------+------------+-------+--------------+
|      2048 |        0,0 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
|      2049 |        0,1 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
|       ... |        ... | ...   | ...          |
+-----------+------------+-------+--------------+
|      3071 |      31,31 | 16,23 | LS2          |
|           |            | 08-15 | LS1          |
|           |            | 00-07 | LS0          |
+-----------+------------+-------+--------------+
</pre></div>
</div>
<p>The <strong>mesh_scale</strong> member determines the precision and minimum and maximum gain.
For example if <strong>mesh_scale</strong> is 0 and therefore selects 0 - 2x gain, a value of
0 in a coefficient means 0.0 gain, a value of 128 means 1.0 gain and 255
means 2.0 gain.</p>
<p>header.type should be set to MALI_C55_PARAM_MESH_SHADING_CONFIG from
<a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a> for this block.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.mali_c55_params_mesh_shading_selection">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">mali_c55_params_mesh_shading_selection</span></span></span><a class="headerlink" href="#c.mali_c55_params_mesh_shading_selection" title="Link to this definition">¶</a><br /></dt>
<dd><p>Mesh table selection</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mali_c55_params_mesh_shading_selection {
    struct v4l2_isp_params_block_header header;
    __u8 mesh_alpha_bank_r;
    __u8 mesh_alpha_bank_g;
    __u8 mesh_alpha_bank_b;
    __u8 mesh_alpha_r;
    __u8 mesh_alpha_g;
    __u8 mesh_alpha_b;
    __u16 mesh_strength;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The Mali-C55 parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_alpha_bank_r</span></code></dt><dd><p>Red mesh table select (c:type:<cite><code class="xref c c-enum broken_xref docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_params_mesh_alpha_bank</span></code></cite>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_alpha_bank_g</span></code></dt><dd><p>Green mesh table select (c:type:<cite><code class="xref c c-enum broken_xref docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_params_mesh_alpha_bank</span></code></cite>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_alpha_bank_b</span></code></dt><dd><p>Blue mesh table select (c:type:<cite><code class="xref c c-enum broken_xref docutils literal notranslate"><span class="pre">enum</span> <span class="pre">mali_c55_params_mesh_alpha_bank</span></code></cite>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_alpha_r</span></code></dt><dd><p>Blend coefficient for R [0..255]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_alpha_g</span></code></dt><dd><p>Blend coefficient for G [0..255]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_alpha_b</span></code></dt><dd><p>Blend coefficient for B [0..255]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mesh_strength</span></code></dt><dd><p>Mesh strength in Q4.12 format [0..4096]</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The module computes the final correction coefficients by blending the ones
from two light source tables, which are selected (independently for each
colour channel) by the <strong>mesh_alpha_bank_r</strong>/g/b fields.</p>
<p>The final blended coefficients for each node are calculated using the
following equation:</p>
<blockquote>
<div><p>Final coefficient = (a * LS<sub>b</sub>+ (256 - a) * LS<sub>a</sub>) / 256</p>
</div></blockquote>
<p>Where a is the <strong>mesh_alpha_r</strong>/g/b value, and LS<sub>a</sub>and LS<sub>b</sub>are the node cofficients for the two tables selected by the
<strong>mesh_alpha_bank_r</strong>/g/b value.</p>
<p>The scale of the applied correction may also be controlled by tuning the
<strong>mesh_strength</strong> member. This is a modifier to the final coefficients which can
be used to globally reduce the gains applied.</p>
<p>header.type should be set to MALI_C55_PARAM_MESH_SHADING_SELECTION from
<a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a> for this block.</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.MALI_C55_PARAMS_MAX_SIZE">
<span class="sig-name descname"><span class="n"><span class="pre">MALI_C55_PARAMS_MAX_SIZE</span></span></span><a class="headerlink" href="#c.MALI_C55_PARAMS_MAX_SIZE" title="Link to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">MALI_C55_PARAMS_MAX_SIZE</span></code></p>
<blockquote>
<div><blockquote>
<div><p>Maximum size of all Mali C55 Parameters</p>
</div></blockquote>
<p><strong>Description</strong></p>
<p>Though the parameters for the Mali-C55 are passed as optional blocks, the
driver still needs to know the absolute maximum size so that it can allocate
a buffer sized appropriately to accommodate userspace attempting to set all
possible parameters in a single frame.</p>
<p>Some structs are in this list multiple times. Where that’s the case, it just
reflects the fact that the same <code class="xref c c-struct broken_xref docutils literal notranslate"><span class="pre">struct</span> <span class="pre">can</span></code> be used with multiple different
header types from <a class="reference internal" href="#c.mali_c55_param_block_type" title="mali_c55_param_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">mali_c55_param_block_type</span></code></a>.</p>
</div></blockquote>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../../_sources/userspace-api/media/v4l/metafmt-arm-mali-c55.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>